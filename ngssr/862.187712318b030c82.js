(self.webpackChunkngdemos=self.webpackChunkngdemos||[]).push([[862],{862:(bt,U,C)=>{"use strict";C.r(U),C.d(U,{BasicChatModule:()=>c});var T=C(4755),m=C(9085),l=C(9401),R=C(4672),b=C.n(R),f=C(2223),x=C(2492);const k=["scrollMe"];function _(a,d){if(1&a&&(f.\u0275\u0275elementStart(0,"div",12)(1,"div",13)(2,"strong",14),f.\u0275\u0275text(3),f.\u0275\u0275elementEnd()(),f.\u0275\u0275elementStart(4,"div",15),f.\u0275\u0275text(5),f.\u0275\u0275elementEnd()()),2&a){const g=d.$implicit;f.\u0275\u0275advance(3),f.\u0275\u0275textInterpolate(g.username),f.\u0275\u0275advance(2),f.\u0275\u0275textInterpolate(g.message)}}const P=[{path:"",component:(()=>{class a{constructor(g){this.chatService=g,this.username="Hemant",this.message="",this.messages=[{username:"Hemant",message:"Hey "},{username:"Vivek",message:"Yes sir"},{username:"Vivek",message:"How are you?"}]}ngOnInit(){this.form=new l.cw({message:new l.NI("")}),b().logToConsole=!0,new(b())("6da8b4c72ac7d3771308",{cluster:"mt1"}).subscribe("chat").bind("message",L=>{console.log("PPP",L),this.messages.push(L)}),this.scrollToBottom()}sendMessage(){this.chatService.sendMessage({username:this.username,...this.form.value}).subscribe(()=>this.form.reset())}ngAfterViewChecked(){this.scrollToBottom()}scrollToBottom(){try{this.myScrollContainer.nativeElement.scrollTop=this.myScrollContainer.nativeElement.scrollHeight}catch{}}}return a.\u0275fac=function(g){return new(g||a)(f.\u0275\u0275directiveInject(x.a))},a.\u0275cmp=f.\u0275\u0275defineComponent({type:a,selectors:[["lib-basic-chat"]],viewQuery:function(g,O){if(1&g&&f.\u0275\u0275viewQuery(k,5),2&g){let L;f.\u0275\u0275queryRefresh(L=f.\u0275\u0275loadQuery())&&(O.myScrollContainer=L.first)}},decls:18,vars:3,consts:[[1,"container"],[1,"d-flex","justify-content-between"],["type","text",1,"form-control",3,"value","input"],[1,"form-inline",3,"formGroup","ngSubmit"],[1,"form-group"],["type","text","name","message","id","message","placeholder","Message","aria-describedby","helpId","formControlName","message",1,"form-control"],["type","submit",1,"btn","btn-primary","ml-2"],[1,"card","mt-4"],[1,"card-header"],[1,"list-group","list-group-flush","border-bottom","scrollarea"],["scrollMe",""],["class","list-group-item list-group-item-action py-3 lh-tight",4,"ngFor","ngForOf"],[1,"list-group-item","list-group-item-action","py-3","lh-tight"],[1,"d-flex","w-100","align-items-center","justify-content-between"],[1,"mb-1"],[1,"col-10","mb-1","small"]],template:function(g,O){1&g&&(f.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"h1"),f.\u0275\u0275text(3,"Chat"),f.\u0275\u0275elementEnd(),f.\u0275\u0275elementStart(4,"div"),f.\u0275\u0275text(5," Username: "),f.\u0275\u0275elementStart(6,"input",2),f.\u0275\u0275listener("input",function(N){return O.username=N.target.value}),f.\u0275\u0275elementEnd()()(),f.\u0275\u0275elementStart(7,"form",3),f.\u0275\u0275listener("ngSubmit",function(){return O.sendMessage()}),f.\u0275\u0275elementStart(8,"div",4),f.\u0275\u0275element(9,"input",5),f.\u0275\u0275elementEnd(),f.\u0275\u0275elementStart(10,"button",6),f.\u0275\u0275text(11,"Send"),f.\u0275\u0275elementEnd()(),f.\u0275\u0275elementStart(12,"div",7)(13,"div",8),f.\u0275\u0275text(14,"Messages"),f.\u0275\u0275elementEnd(),f.\u0275\u0275elementStart(15,"div",9,10),f.\u0275\u0275template(17,_,6,2,"div",11),f.\u0275\u0275elementEnd()()()),2&g&&(f.\u0275\u0275advance(6),f.\u0275\u0275property("value",O.username),f.\u0275\u0275advance(1),f.\u0275\u0275property("formGroup",O.form),f.\u0275\u0275advance(10),f.\u0275\u0275property("ngForOf",O.messages))},dependencies:[T.sg,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u],styles:[".scrollarea[_ngcontent-%COMP%]{max-height:400px;overflow-y:scroll}"]}),a})()}];let v=(()=>{class a{}return a.\u0275fac=function(g){return new(g||a)},a.\u0275mod=f.\u0275\u0275defineNgModule({type:a}),a.\u0275inj=f.\u0275\u0275defineInjector({imports:[m.Bz.forChild(P),m.Bz]}),a})(),c=(()=>{class a{}return a.\u0275fac=function(g){return new(g||a)},a.\u0275mod=f.\u0275\u0275defineNgModule({type:a}),a.\u0275inj=f.\u0275\u0275defineInjector({imports:[T.ez,v,l.UX]}),a})()},4672:bt=>{window,bt.exports=function(U){var C={};function T(m){if(C[m])return C[m].exports;var l=C[m]={i:m,l:!1,exports:{}};return U[m].call(l.exports,l,l.exports,T),l.l=!0,l.exports}return T.m=U,T.c=C,T.d=function(m,l,R){T.o(m,l)||Object.defineProperty(m,l,{enumerable:!0,get:R})},T.r=function(m){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(m,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(m,"__esModule",{value:!0})},T.t=function(m,l){if(1&l&&(m=T(m)),8&l||4&l&&"object"==typeof m&&m&&m.__esModule)return m;var R=Object.create(null);if(T.r(R),Object.defineProperty(R,"default",{enumerable:!0,value:m}),2&l&&"string"!=typeof m)for(var b in m)T.d(R,b,function(f){return m[f]}.bind(null,b));return R},T.n=function(m){var l=m&&m.__esModule?function(){return m.default}:function(){return m};return T.d(l,"a",l),l},T.o=function(m,l){return Object.prototype.hasOwnProperty.call(m,l)},T.p="",T(T.s=2)}([function(U,C,T){"use strict";var v,m=this&&this.__extends||(v=function(c,a){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,g){d.__proto__=g}||function(d,g){for(var O in g)g.hasOwnProperty(O)&&(d[O]=g[O])})(c,a)},function(c,a){function d(){this.constructor=c}v(c,a),c.prototype=null===a?Object.create(a):(d.prototype=a.prototype,new d)});Object.defineProperty(C,"__esModule",{value:!0});var l=256,R=function(){function v(c){void 0===c&&(c="="),this._paddingCharacter=c}return v.prototype.encodedLength=function(c){return this._paddingCharacter?(c+2)/3*4|0:(8*c+5)/6|0},v.prototype.encode=function(c){for(var a="",d=0;d<c.length-2;d+=3)a+=this._encodeByte((g=c[d]<<16|c[d+1]<<8|c[d+2])>>>18&63),a+=this._encodeByte(g>>>12&63),a+=this._encodeByte(g>>>6&63),a+=this._encodeByte(g>>>0&63);var g,O=c.length-d;return O>0&&(a+=this._encodeByte((g=c[d]<<16|(2===O?c[d+1]<<8:0))>>>18&63),a+=this._encodeByte(g>>>12&63),a+=2===O?this._encodeByte(g>>>6&63):this._paddingCharacter||"",a+=this._paddingCharacter||""),a},v.prototype.maxDecodedLength=function(c){return this._paddingCharacter?c/4*3|0:(6*c+7)/8|0},v.prototype.decodedLength=function(c){return this.maxDecodedLength(c.length-this._getPaddingLength(c))},v.prototype.decode=function(c){if(0===c.length)return new Uint8Array(0);for(var a=this._getPaddingLength(c),d=c.length-a,g=new Uint8Array(this.maxDecodedLength(d)),O=0,L=0,N=0,F=0,D=0,M=0,H=0;L<d-4;L+=4)F=this._decodeChar(c.charCodeAt(L+0)),D=this._decodeChar(c.charCodeAt(L+1)),M=this._decodeChar(c.charCodeAt(L+2)),H=this._decodeChar(c.charCodeAt(L+3)),g[O++]=F<<2|D>>>4,g[O++]=D<<4|M>>>2,g[O++]=M<<6|H,N|=F&l,N|=D&l,N|=M&l,N|=H&l;if(L<d-1&&(F=this._decodeChar(c.charCodeAt(L)),D=this._decodeChar(c.charCodeAt(L+1)),g[O++]=F<<2|D>>>4,N|=F&l,N|=D&l),L<d-2&&(M=this._decodeChar(c.charCodeAt(L+2)),g[O++]=D<<4|M>>>2,N|=M&l),L<d-3&&(H=this._decodeChar(c.charCodeAt(L+3)),g[O++]=M<<6|H,N|=H&l),0!==N)throw new Error("Base64Coder: incorrect characters for decoding");return g},v.prototype._encodeByte=function(c){var a=c;return a+=65,a+=25-c>>>8&6,a+=51-c>>>8&-75,a+=61-c>>>8&-15,a+=62-c>>>8&3,String.fromCharCode(a)},v.prototype._decodeChar=function(c){var a=l;return a+=(42-c&c-44)>>>8&-l+c-43+62,a+=(46-c&c-48)>>>8&-l+c-47+63,a+=(47-c&c-58)>>>8&-l+c-48+52,(a+=(64-c&c-91)>>>8&-l+c-65+0)+((96-c&c-123)>>>8&-l+c-97+26)},v.prototype._getPaddingLength=function(c){var a=0;if(this._paddingCharacter){for(var d=c.length-1;d>=0&&c[d]===this._paddingCharacter;d--)a++;if(c.length<4||a>2)throw new Error("Base64Coder: incorrect padding")}return a},v}();C.Coder=R;var b=new R;C.encode=function f(v){return b.encode(v)},C.decode=function x(v){return b.decode(v)};var k=function(v){function c(){return null!==v&&v.apply(this,arguments)||this}return m(c,v),c.prototype._encodeByte=function(a){var d=a;return d+=65,d+=25-a>>>8&6,d+=51-a>>>8&-75,d+=61-a>>>8&-13,d+=62-a>>>8&49,String.fromCharCode(d)},c.prototype._decodeChar=function(a){var d=l;return d+=(44-a&a-46)>>>8&-l+a-45+62,d+=(94-a&a-96)>>>8&-l+a-95+63,d+=(47-a&a-58)>>>8&-l+a-48+52,(d+=(64-a&a-91)>>>8&-l+a-65+0)+((96-a&a-123)>>>8&-l+a-97+26)},c}(R);C.URLSafeCoder=k;var _=new k;C.encodeURLSafe=function w(v){return _.encode(v)},C.decodeURLSafe=function P(v){return _.decode(v)},C.encodedLength=function(v){return b.encodedLength(v)},C.maxDecodedLength=function(v){return b.maxDecodedLength(v)},C.decodedLength=function(v){return b.decodedLength(v)}},function(U,C,T){"use strict";Object.defineProperty(C,"__esModule",{value:!0});var m="utf8: invalid string",l="utf8: invalid source encoding";function b(x){for(var k=0,_=0;_<x.length;_++){var w=x.charCodeAt(_);if(w<128)k+=1;else if(w<2048)k+=2;else if(w<55296)k+=3;else{if(!(w<=57343))throw new Error(m);if(_>=x.length-1)throw new Error(m);_++,k+=4}}return k}C.encode=function R(x){for(var k=new Uint8Array(b(x)),_=0,w=0;w<x.length;w++){var P=x.charCodeAt(w);P<128?k[_++]=P:P<2048?(k[_++]=192|P>>6,k[_++]=128|63&P):P<55296?(k[_++]=224|P>>12,k[_++]=128|P>>6&63,k[_++]=128|63&P):(w++,P=(1023&P)<<10,P|=1023&x.charCodeAt(w),k[_++]=240|(P+=65536)>>18,k[_++]=128|P>>12&63,k[_++]=128|P>>6&63,k[_++]=128|63&P)}return k},C.encodedLength=b,C.decode=function f(x){for(var k=[],_=0;_<x.length;_++){var w=x[_];if(128&w){var P=void 0;if(w<224){if(_>=x.length)throw new Error(l);if(128!=(192&(v=x[++_])))throw new Error(l);w=(31&w)<<6|63&v,P=128}else if(w<240){if(_>=x.length-1)throw new Error(l);var v=x[++_],c=x[++_];if(128!=(192&v)||128!=(192&c))throw new Error(l);w=(15&w)<<12|(63&v)<<6|63&c,P=2048}else{if(!(w<248))throw new Error(l);if(_>=x.length-2)throw new Error(l);v=x[++_],c=x[++_];var a=x[++_];if(128!=(192&v)||128!=(192&c)||128!=(192&a))throw new Error(l);w=(15&w)<<18|(63&v)<<12|(63&c)<<6|63&a,P=65536}if(w<P||w>=55296&&w<=57343)throw new Error(l);if(w>=65536){if(w>1114111)throw new Error(l);w-=65536,k.push(String.fromCharCode(55296|w>>10)),w=56320|1023&w}}k.push(String.fromCharCode(w))}return k.join("")}},function(U,C,T){U.exports=T(3).default},function(U,C,T){"use strict";T.r(C);var n,m=function(){function n(t,e){this.lastId=0,this.prefix=t,this.name=e}return n.prototype.create=function(t){this.lastId++;var e=this.lastId,r=this.prefix+e,i=this.name+"["+e+"]",o=!1,s=function(){o||(t.apply(null,arguments),o=!0)};return this[e]=s,{number:e,id:r,name:i,callback:s}},n.prototype.remove=function(t){delete this[t.number]},n}(),l=new m("_pusher_script_","Pusher.ScriptReceivers"),b={VERSION:"8.0.2",PROTOCOL:7,wsPort:80,wssPort:443,wsPath:"",httpHost:"sockjs.pusher.com",httpPort:80,httpsPort:443,httpPath:"/pusher",stats_host:"stats.pusher.com",authEndpoint:"/pusher/auth",authTransport:"ajax",activityTimeout:12e4,pongTimeout:3e4,unavailableTimeout:1e4,userAuthentication:{endpoint:"/pusher/user-auth",transport:"ajax"},channelAuthorization:{endpoint:"/pusher/auth",transport:"ajax"},cdn_http:"http://js.pusher.com",cdn_https:"https://js.pusher.com",dependency_suffix:""},f=function(){function n(t){this.options=t,this.receivers=t.receivers||l,this.loading={}}return n.prototype.load=function(t,e,r){var i=this;if(i.loading[t]&&i.loading[t].length>0)i.loading[t].push(r);else{i.loading[t]=[r];var o=y.createScriptRequest(i.getPath(t,e)),s=i.receivers.create(function(u){if(i.receivers.remove(s),i.loading[t]){var p=i.loading[t];delete i.loading[t];for(var h=function(E){E||o.cleanup()},S=0;S<p.length;S++)p[S](u,h)}});o.send(s)}},n.prototype.getRoot=function(t){var r=y.getDocument().location.protocol;return(t&&t.useTLS||"https:"===r?this.options.cdn_https:this.options.cdn_http).replace(/\/*$/,"")+"/"+this.options.version},n.prototype.getPath=function(t,e){return this.getRoot(e)+"/"+t+this.options.suffix+".js"},n}(),x=f,k=new m("_pusher_dependencies","Pusher.DependenciesReceivers"),_=new x({cdn_http:b.cdn_http,cdn_https:b.cdn_https,version:b.VERSION,suffix:b.dependency_suffix,receivers:k}),w={baseUrl:"https://pusher.com",urls:{authenticationEndpoint:{path:"/docs/channels/server_api/authenticating_users"},authorizationEndpoint:{path:"/docs/channels/server_api/authorizing-users/"},javascriptQuickStart:{path:"/docs/javascript_quick_start"},triggeringClientEvents:{path:"/docs/client_api_guide/client_events#trigger-events"},encryptedChannelSupport:{fullUrl:"https://github.com/pusher/pusher-js/tree/cc491015371a4bde5743d1c87a0fbac0feb53195#encrypted-channel-support"}}},v_buildLogSuffix=function(n){var r,e=w.urls[n];return e?(e.fullUrl?r=e.fullUrl:e.path&&(r=w.baseUrl+e.path),r?"See: "+r:""):""},c=(()=>((c=c||{}).UserAuthentication="user-authentication",c.ChannelAuthorization="channel-authorization",c))(),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),d=function(n){function t(e){var r=this.constructor,i=n.call(this,e)||this;return Object.setPrototypeOf(i,r.prototype),i}return a(t,n),t}(Error),g=function(n){function t(e){var r=this.constructor,i=n.call(this,e)||this;return Object.setPrototypeOf(i,r.prototype),i}return a(t,n),t}(Error),O=function(n){function t(e){var r=this.constructor,i=n.call(this,e)||this;return Object.setPrototypeOf(i,r.prototype),i}return a(t,n),t}(Error),L=function(n){function t(e){var r=this.constructor,i=n.call(this,e)||this;return Object.setPrototypeOf(i,r.prototype),i}return a(t,n),t}(Error),N=function(n){function t(e){var r=this.constructor,i=n.call(this,e)||this;return Object.setPrototypeOf(i,r.prototype),i}return a(t,n),t}(Error),F=function(n){function t(e){var r=this.constructor,i=n.call(this,e)||this;return Object.setPrototypeOf(i,r.prototype),i}return a(t,n),t}(Error),D=function(n){function t(e){var r=this.constructor,i=n.call(this,e)||this;return Object.setPrototypeOf(i,r.prototype),i}return a(t,n),t}(Error),M=function(n){function t(e){var r=this.constructor,i=n.call(this,e)||this;return Object.setPrototypeOf(i,r.prototype),i}return a(t,n),t}(Error),H=function(n){function t(e,r){var i=this.constructor,o=n.call(this,r)||this;return o.status=e,Object.setPrototypeOf(o,i.prototype),o}return a(t,n),t}(Error),$t=function(n,t,e,r,i){var o=y.createXHR();for(var s in o.open("POST",e.endpoint,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.headers)o.setRequestHeader(s,e.headers[s]);if(null!=e.headersProvider){var u=e.headersProvider();for(var s in u)o.setRequestHeader(s,u[s])}return o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status){var p=void 0,h=!1;try{p=JSON.parse(o.responseText),h=!0}catch{i(new H(200,"JSON returned from "+r.toString()+" endpoint was invalid, yet status code was 200. Data was: "+o.responseText),null)}h&&i(null,p)}else{var S="";switch(r){case c.UserAuthentication:S=v_buildLogSuffix("authenticationEndpoint");break;case c.ChannelAuthorization:S="Clients must be authorized to join private or presence channels. "+v_buildLogSuffix("authorizationEndpoint")}i(new H(o.status,"Unable to retrieve auth string from "+r.toString()+" endpoint - received status: "+o.status+" from "+e.endpoint+". "+S),null)}},o.send(t),o};for(var tt=String.fromCharCode,$="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Zt={},it=0;it<64;it++)Zt[$.charAt(it)]=it;var ee=function(n){var t=n.charCodeAt(0);return t<128?n:t<2048?tt(192|t>>>6)+tt(128|63&t):tt(224|t>>>12&15)+tt(128|t>>>6&63)+tt(128|63&t)},ne=function(n){return n.replace(/[^\x00-\x7F]/g,ee)},re=function(n){var t=[0,2,1][n.length%3],e=n.charCodeAt(0)<<16|(n.length>1?n.charCodeAt(1):0)<<8|(n.length>2?n.charCodeAt(2):0);return[$.charAt(e>>>18),$.charAt(e>>>12&63),t>=2?"=":$.charAt(e>>>6&63),t>=1?"=":$.charAt(63&e)].join("")},ie=window.btoa||function(n){return n.replace(/[\s\S]{1,3}/g,re)},oe=function(){function n(t,e,r,i){var o=this;this.clear=e,this.timer=t(function(){o.timer&&(o.timer=i(o.timer))},r)}return n.prototype.isRunning=function(){return null!==this.timer},n.prototype.ensureAborted=function(){this.timer&&(this.clear(this.timer),this.timer=null)},n}(),wt=oe,St=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])})(t,e)};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();function se(n){window.clearTimeout(n)}function ae(n){window.clearInterval(n)}var G=function(n){function t(e,r){return n.call(this,setTimeout,se,e,function(i){return r(),null})||this}return St(t,n),t}(wt),ce=function(n){function t(e,r){return n.call(this,setInterval,ae,e,function(i){return r(),i})||this}return St(t,n),t}(wt),ue={now:function(){return Date.now?Date.now():(new Date).valueOf()},defer:function(n){return new G(0,n)},method:function(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];var r=Array.prototype.slice.call(arguments,1);return function(i){return i[n].apply(i,r.concat(arguments))}}},j=ue;function I(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];for(var r=0;r<t.length;r++){var i=t[r];for(var o in i)n[o]=i[o]&&i[o].constructor&&i[o].constructor===Object?I(n[o]||{},i[o]):i[o]}return n}function he(){for(var n=["Pusher"],t=0;t<arguments.length;t++)n.push("string"==typeof arguments[t]?arguments[t]:ot(arguments[t]));return n.join(" : ")}function Ct(n,t){var e=Array.prototype.indexOf;if(null===n)return-1;if(e&&n.indexOf===e)return n.indexOf(t);for(var r=0,i=n.length;r<i;r++)if(n[r]===t)return r;return-1}function X(n,t){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(n[e],e,n)}function Tt(n){var t=[];return X(n,function(e,r){t.push(r)}),t}function et(n,t,e){for(var r=0;r<n.length;r++)t.call(e||window,n[r],r,n)}function kt(n,t){for(var e=[],r=0;r<n.length;r++)e.push(t(n[r],r,n,e));return e}function Pt(n,t){t=t||function(i){return!!i};for(var e=[],r=0;r<n.length;r++)t(n[r],r,n,e)&&e.push(n[r]);return e}function xt(n,t){var e={};return X(n,function(r,i){(t&&t(r,i,n,e)||r)&&(e[i]=r)}),e}function Ot(n,t){for(var e=0;e<n.length;e++)if(t(n[e],e,n))return!0;return!1}function ve(n){return function fe(n,t){var e={};return X(n,function(r,i){e[i]=t(r)}),e}(n,function(t){return"object"==typeof t&&(t=ot(t)),encodeURIComponent(function Kt(n){return ie(ne(n))}(t.toString()))})}function ge(n){return kt(function pe(n){var t=[];return X(n,function(e,r){t.push([r,e])}),t}(ve(xt(n,function(r){return void 0!==r}))),j.method("join","=")).join("&")}function ot(n){try{return JSON.stringify(n)}catch{return JSON.stringify(function ye(n){var t=[],e=[];return function r(i,o){var s,u,p;switch(typeof i){case"object":if(!i)return null;for(s=0;s<t.length;s+=1)if(t[s]===i)return{$ref:e[s]};if(t.push(i),e.push(o),"[object Array]"===Object.prototype.toString.apply(i))for(p=[],s=0;s<i.length;s+=1)p[s]=r(i[s],o+"["+s+"]");else for(u in p={},i)Object.prototype.hasOwnProperty.call(i,u)&&(p[u]=r(i[u],o+"["+JSON.stringify(u)+"]"));return p;case"number":case"string":case"boolean":return i}}(n,"$")}(n))}}var me=function(){function n(){this.globalLog=function(t){window.console&&window.console.log&&window.console.log(t)}}return n.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.log(this.globalLog,t)},n.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.log(this.globalLogWarn,t)},n.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.log(this.globalLogError,t)},n.prototype.globalLogWarn=function(t){window.console&&window.console.warn?window.console.warn(t):this.globalLog(t)},n.prototype.globalLogError=function(t){window.console&&window.console.error?window.console.error(t):this.globalLogWarn(t)},n.prototype.log=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var i=he.apply(this,arguments);yt.log?yt.log(i):yt.logToConsole&&t.bind(this)(i)},n}(),A=new me,be=function(n,t,e,r,i){(void 0!==e.headers||null!=e.headersProvider)&&A.warn("To send headers with the "+r.toString()+" request, you must use AJAX, rather than JSONP.");var o=n.nextAuthCallbackID.toString();n.nextAuthCallbackID++;var s=n.getDocument(),u=s.createElement("script");n.auth_callbacks[o]=function(S){i(null,S)},u.src=e.endpoint+"?callback="+encodeURIComponent("Pusher.auth_callbacks['"+o+"']")+"&"+t;var h=s.getElementsByTagName("head")[0]||s.documentElement;h.insertBefore(u,h.firstChild)},we=function(){function n(t){this.src=t}return n.prototype.send=function(t){var e=this,r="Error loading "+e.src;e.script=document.createElement("script"),e.script.id=t.id,e.script.src=e.src,e.script.type="text/javascript",e.script.charset="UTF-8",e.script.addEventListener?(e.script.onerror=function(){t.callback(r)},e.script.onload=function(){t.callback(null)}):e.script.onreadystatechange=function(){("loaded"===e.script.readyState||"complete"===e.script.readyState)&&t.callback(null)},void 0===e.script.async&&document.attachEvent&&/opera/i.test(navigator.userAgent)?(e.errorScript=document.createElement("script"),e.errorScript.id=t.id+"_error",e.errorScript.text=t.name+"('"+r+"');",e.script.async=e.errorScript.async=!1):e.script.async=!0;var i=document.getElementsByTagName("head")[0];i.insertBefore(e.script,i.firstChild),e.errorScript&&i.insertBefore(e.errorScript,e.script.nextSibling)},n.prototype.cleanup=function(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null),this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script),this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript),this.script=null,this.errorScript=null},n}(),Se=we,Ce=function(){function n(t,e){this.url=t,this.data=e}return n.prototype.send=function(t){if(!this.request){var e=ge(this.data);this.request=y.createScriptRequest(this.url+"/"+t.number+"?"+e),this.request.send(t)}},n.prototype.cleanup=function(){this.request&&this.request.cleanup()},n}(),Te=Ce,xe={name:"jsonp",getAgent:function(n,t){return function(e,r){var s=y.createJSONPRequest("http"+(t?"s":"")+"://"+(n.host||n.options.host)+n.options.path,e),u=y.ScriptReceivers.create(function(p,h){l.remove(u),s.cleanup(),h&&h.host&&(n.host=h.host),r&&r(p,h)});s.send(u)}}};function ut(n,t,e){return n+(t.useTLS?"s":"")+"://"+(t.useTLS?t.hostTLS:t.hostNonTLS)+e}function ht(n,t){return"/app/"+n+"?protocol="+b.PROTOCOL+"&client=js&version="+b.VERSION+(t?"&"+t:"")}var Oe={getInitial:function(n,t){return ut("ws",t,(t.httpPath||"")+ht(n,"flash=false"))}},Le={getInitial:function(n,t){return ut("http",t,(t.httpPath||"/pusher")+ht(n))}},Ae={getInitial:function(n,t){return ut("http",t,t.httpPath||"/pusher")},getPath:function(n,t){return ht(n)}},Ee=function(){function n(){this._callbacks={}}return n.prototype.get=function(t){return this._callbacks[lt(t)]},n.prototype.add=function(t,e,r){var i=lt(t);this._callbacks[i]=this._callbacks[i]||[],this._callbacks[i].push({fn:e,context:r})},n.prototype.remove=function(t,e,r){if(t||e||r){var i=t?[lt(t)]:Tt(this._callbacks);e||r?this.removeCallback(i,e,r):this.removeAllCallbacks(i)}else this._callbacks={}},n.prototype.removeCallback=function(t,e,r){et(t,function(i){this._callbacks[i]=Pt(this._callbacks[i]||[],function(o){return e&&e!==o.fn||r&&r!==o.context}),0===this._callbacks[i].length&&delete this._callbacks[i]},this)},n.prototype.removeAllCallbacks=function(t){et(t,function(e){delete this._callbacks[e]},this)},n}(),Re=Ee;function lt(n){return"_"+n}var je=function(){function n(t){this.callbacks=new Re,this.global_callbacks=[],this.failThrough=t}return n.prototype.bind=function(t,e,r){return this.callbacks.add(t,e,r),this},n.prototype.bind_global=function(t){return this.global_callbacks.push(t),this},n.prototype.unbind=function(t,e,r){return this.callbacks.remove(t,e,r),this},n.prototype.unbind_global=function(t){return t?(this.global_callbacks=Pt(this.global_callbacks||[],function(e){return e!==t}),this):(this.global_callbacks=[],this)},n.prototype.unbind_all=function(){return this.unbind(),this.unbind_global(),this},n.prototype.emit=function(t,e,r){for(var i=0;i<this.global_callbacks.length;i++)this.global_callbacks[i](t,e);var o=this.callbacks.get(t),s=[];if(r?s.push(e,r):e&&s.push(e),o&&o.length>0)for(i=0;i<o.length;i++)o[i].fn.apply(o[i].context||window,s);else this.failThrough&&this.failThrough(t,e);return this},n}(),J=je,Ie=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])})(t,e)};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ne=function(n){function t(e,r,i,o,s){var u=n.call(this)||this;return u.initialize=y.transportConnectionInitializer,u.hooks=e,u.name=r,u.priority=i,u.key=o,u.options=s,u.state="new",u.timeline=s.timeline,u.activityTimeout=s.activityTimeout,u.id=u.timeline.generateUniqueID(),u}return Ie(t,n),t.prototype.handlesActivityChecks=function(){return!!this.hooks.handlesActivityChecks},t.prototype.supportsPing=function(){return!!this.hooks.supportsPing},t.prototype.connect=function(){var e=this;if(this.socket||"initialized"!==this.state)return!1;var r=this.hooks.urls.getInitial(this.key,this.options);try{this.socket=this.hooks.getSocket(r,this.options)}catch(i){return j.defer(function(){e.onError(i),e.changeState("closed")}),!1}return this.bindListeners(),A.debug("Connecting",{transport:this.name,url:r}),this.changeState("connecting"),!0},t.prototype.close=function(){return!!this.socket&&(this.socket.close(),!0)},t.prototype.send=function(e){var r=this;return"open"===this.state&&(j.defer(function(){r.socket&&r.socket.send(e)}),!0)},t.prototype.ping=function(){"open"===this.state&&this.supportsPing()&&this.socket.ping()},t.prototype.onOpen=function(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options)),this.changeState("open"),this.socket.onopen=void 0},t.prototype.onError=function(e){this.emit("error",{type:"WebSocketError",error:e}),this.timeline.error(this.buildTimelineMessage({error:e.toString()}))},t.prototype.onClose=function(e){e?this.changeState("closed",{code:e.code,reason:e.reason,wasClean:e.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=void 0},t.prototype.onMessage=function(e){this.emit("message",e)},t.prototype.onActivity=function(){this.emit("activity")},t.prototype.bindListeners=function(){var e=this;this.socket.onopen=function(){e.onOpen()},this.socket.onerror=function(r){e.onError(r)},this.socket.onclose=function(r){e.onClose(r)},this.socket.onmessage=function(r){e.onMessage(r)},this.supportsPing()&&(this.socket.onactivity=function(){e.onActivity()})},t.prototype.unbindListeners=function(){this.socket&&(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))},t.prototype.changeState=function(e,r){this.state=e,this.timeline.info(this.buildTimelineMessage({state:e,params:r})),this.emit(e,r)},t.prototype.buildTimelineMessage=function(e){return I({cid:this.id},e)},t}(J),Ue=Ne,Me=function(){function n(t){this.hooks=t}return n.prototype.isSupported=function(t){return this.hooks.isSupported(t)},n.prototype.createConnection=function(t,e,r,i){return new Ue(this.hooks,t,e,r,i)},n}(),K=Me,De=new K({urls:Oe,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return!!y.getWebSocketAPI()},isSupported:function(){return!!y.getWebSocketAPI()},getSocket:function(n){return y.createWebSocket(n)}}),Lt={urls:Le,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return!0}},At=I({getSocket:function(n){return y.HTTPFactory.createStreamingSocket(n)}},Lt),Et=I({getSocket:function(n){return y.HTTPFactory.createPollingSocket(n)}},Lt),Rt={isSupported:function(){return y.isXHRSupported()}},st={ws:De,xhr_streaming:new K(I({},At,Rt)),xhr_polling:new K(I({},Et,Rt))},ze=new K({file:"sockjs",urls:Ae,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return void 0!==window.SockJS},getSocket:function(n,t){return new window.SockJS(n,null,{js_path:_.getPath("sockjs",{useTLS:t.useTLS}),ignore_null_origin:t.ignoreNullOrigin})},beforeOpen:function(n,t){n.send(JSON.stringify({path:t}))}}),jt={isSupported:function(n){return y.isXDRSupported(n.useTLS)}},Fe=new K(I({},At,jt)),Xe=new K(I({},Et,jt));st.xdr_streaming=Fe,st.xdr_polling=Xe,st.sockjs=ze;var Je=st,We=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])})(t,e)};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ge=function(n){function t(){var e=n.call(this)||this,r=e;return void 0!==window.addEventListener&&(window.addEventListener("online",function(){r.emit("online")},!1),window.addEventListener("offline",function(){r.emit("offline")},!1)),e}return We(t,n),t.prototype.isOnline=function(){return void 0===window.navigator.onLine||window.navigator.onLine},t}(J),Ve=new Ge,Qe=function(){function n(t,e,r){this.manager=t,this.transport=e,this.minPingDelay=r.minPingDelay,this.maxPingDelay=r.maxPingDelay,this.pingDelay=void 0}return n.prototype.createConnection=function(t,e,r,i){var o=this;i=I({},i,{activityTimeout:this.pingDelay});var s=this.transport.createConnection(t,e,r,i),u=null,p=function(){s.unbind("open",p),s.bind("closed",h),u=j.now()},h=function(S){if(s.unbind("closed",h),1002===S.code||1003===S.code)o.manager.reportDeath();else if(!S.wasClean&&u){var E=j.now()-u;E<2*o.maxPingDelay&&(o.manager.reportDeath(),o.pingDelay=Math.max(E/2,o.minPingDelay))}};return s.bind("open",p),s},n.prototype.isSupported=function(t){return this.manager.isAlive()&&this.transport.isSupported(t)},n}(),Ye=Qe,It={decodeMessage:function(n){try{var t=JSON.parse(n.data),e=t.data;if("string"==typeof e)try{e=JSON.parse(t.data)}catch{}var r={event:t.event,channel:t.channel,data:e};return t.user_id&&(r.user_id=t.user_id),r}catch(i){throw{type:"MessageParseError",error:i,data:n.data}}},encodeMessage:function(n){return JSON.stringify(n)},processHandshake:function(n){var t=It.decodeMessage(n);if("pusher:connection_established"===t.event){if(!t.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:t.data.socket_id,activityTimeout:1e3*t.data.activity_timeout}}if("pusher:error"===t.event)return{action:this.getCloseAction(t.data),error:this.getCloseError(t.data)};throw"Invalid handshake"},getCloseAction:function(n){return n.code<4e3?n.code>=1002&&n.code<=1004?"backoff":null:4e3===n.code?"tls_only":n.code<4100?"refused":n.code<4200?"backoff":n.code<4300?"retry":"refused"},getCloseError:function(n){return 1e3!==n.code&&1001!==n.code?{type:"PusherError",data:{code:n.code,message:n.reason||n.message}}:null}},V=It,$e=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])})(t,e)};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ke=function(n){function t(e,r){var i=n.call(this)||this;return i.id=e,i.transport=r,i.activityTimeout=r.activityTimeout,i.bindListeners(),i}return $e(t,n),t.prototype.handlesActivityChecks=function(){return this.transport.handlesActivityChecks()},t.prototype.send=function(e){return this.transport.send(e)},t.prototype.send_event=function(e,r,i){var o={event:e,data:r};return i&&(o.channel=i),A.debug("Event sent",o),this.send(V.encodeMessage(o))},t.prototype.ping=function(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})},t.prototype.close=function(){this.transport.close()},t.prototype.bindListeners=function(){var e=this,r={message:function(o){var s;try{s=V.decodeMessage(o)}catch(u){e.emit("error",{type:"MessageParseError",error:u,data:o.data})}if(void 0!==s){switch(A.debug("Event recd",s),s.event){case"pusher:error":e.emit("error",{type:"PusherError",data:s.data});break;case"pusher:ping":e.emit("ping");break;case"pusher:pong":e.emit("pong")}e.emit("message",s)}},activity:function(){e.emit("activity")},error:function(o){e.emit("error",o)},closed:function(o){i(),o&&o.code&&e.handleCloseEvent(o),e.transport=null,e.emit("closed")}},i=function(){X(r,function(o,s){e.transport.unbind(s,o)})};X(r,function(o,s){e.transport.bind(s,o)})},t.prototype.handleCloseEvent=function(e){var r=V.getCloseAction(e),i=V.getCloseError(e);i&&this.emit("error",i),r&&this.emit(r,{action:r,error:i})},t}(J),Ze=Ke,tn=function(){function n(t,e){this.transport=t,this.callback=e,this.bindListeners()}return n.prototype.close=function(){this.unbindListeners(),this.transport.close()},n.prototype.bindListeners=function(){var t=this;this.onMessage=function(e){var r;t.unbindListeners();try{r=V.processHandshake(e)}catch(i){return t.finish("error",{error:i}),void t.transport.close()}"connected"===r.action?t.finish("connected",{connection:new Ze(r.id,t.transport),activityTimeout:r.activityTimeout}):(t.finish(r.action,{error:r.error}),t.transport.close())},this.onClosed=function(e){t.unbindListeners();var r=V.getCloseAction(e)||"backoff",i=V.getCloseError(e);t.finish(r,{error:i})},this.transport.bind("message",this.onMessage),this.transport.bind("closed",this.onClosed)},n.prototype.unbindListeners=function(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)},n.prototype.finish=function(t,e){this.callback(I({transport:this.transport,action:t},e))},n}(),en=tn,nn=function(){function n(t,e){this.timeline=t,this.options=e||{}}return n.prototype.send=function(t,e){this.timeline.isEmpty()||this.timeline.send(y.TimelineTransport.getAgent(this,t),e)},n}(),rn=nn,on=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])})(t,e)};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),sn=function(n){function t(e,r){var i=n.call(this,function(o,s){A.debug("No callbacks on "+e+" for "+o)})||this;return i.name=e,i.pusher=r,i.subscribed=!1,i.subscriptionPending=!1,i.subscriptionCancelled=!1,i}return on(t,n),t.prototype.authorize=function(e,r){return r(null,{auth:""})},t.prototype.trigger=function(e,r){if(0!==e.indexOf("client-"))throw new d("Event '"+e+"' does not start with 'client-'");if(!this.subscribed){var i=v_buildLogSuffix("triggeringClientEvents");A.warn("Client event triggered before channel 'subscription_succeeded' event . "+i)}return this.pusher.send_event(e,r,this.name)},t.prototype.disconnect=function(){this.subscribed=!1,this.subscriptionPending=!1},t.prototype.handleEvent=function(e){var r=e.event,i=e.data;"pusher_internal:subscription_succeeded"===r?this.handleSubscriptionSucceededEvent(e):"pusher_internal:subscription_count"===r?this.handleSubscriptionCountEvent(e):0!==r.indexOf("pusher_internal:")&&this.emit(r,i,{})},t.prototype.handleSubscriptionSucceededEvent=function(e){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):this.emit("pusher:subscription_succeeded",e.data)},t.prototype.handleSubscriptionCountEvent=function(e){e.data.subscription_count&&(this.subscriptionCount=e.data.subscription_count),this.emit("pusher:subscription_count",e.data)},t.prototype.subscribe=function(){var e=this;this.subscribed||(this.subscriptionPending=!0,this.subscriptionCancelled=!1,this.authorize(this.pusher.connection.socket_id,function(r,i){r?(e.subscriptionPending=!1,A.error(r.toString()),e.emit("pusher:subscription_error",Object.assign({},{type:"AuthError",error:r.message},r instanceof H?{status:r.status}:{}))):e.pusher.send_event("pusher:subscribe",{auth:i.auth,channel_data:i.channel_data,channel:e.name})}))},t.prototype.unsubscribe=function(){this.subscribed=!1,this.pusher.send_event("pusher:unsubscribe",{channel:this.name})},t.prototype.cancelSubscription=function(){this.subscriptionCancelled=!0},t.prototype.reinstateSubscription=function(){this.subscriptionCancelled=!1},t}(J),ft=sn,an=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])})(t,e)};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),cn=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return an(t,n),t.prototype.authorize=function(e,r){return this.pusher.config.channelAuthorizer({channelName:this.name,socketId:e},r)},t}(ft),pt=cn,un=function(){function n(){this.reset()}return n.prototype.get=function(t){return Object.prototype.hasOwnProperty.call(this.members,t)?{id:t,info:this.members[t]}:null},n.prototype.each=function(t){var e=this;X(this.members,function(r,i){t(e.get(i))})},n.prototype.setMyID=function(t){this.myID=t},n.prototype.onSubscription=function(t){this.members=t.presence.hash,this.count=t.presence.count,this.me=this.get(this.myID)},n.prototype.addMember=function(t){return null===this.get(t.user_id)&&this.count++,this.members[t.user_id]=t.user_info,this.get(t.user_id)},n.prototype.removeMember=function(t){var e=this.get(t.user_id);return e&&(delete this.members[t.user_id],this.count--),e},n.prototype.reset=function(){this.members={},this.count=0,this.myID=null,this.me=null},n}(),hn=un,ln=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])})(t,e)};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),fn=function(n,t,e,r){return new(e||(e=Promise))(function(o,s){function u(S){try{h(r.next(S))}catch(E){s(E)}}function p(S){try{h(r.throw(S))}catch(E){s(E)}}function h(S){S.done?o(S.value):function i(o){return o instanceof e?o:new e(function(s){s(o)})}(S.value).then(u,p)}h((r=r.apply(n,t||[])).next())})},pn=function(n,t){var r,i,o,s,e={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(h){return function(S){return function p(h){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,i&&(o=2&h[0]?i.return:h[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,h[1])).done)return o;switch(i=0,o&&(h=[2&h[0],o.value]),h[0]){case 0:case 1:o=h;break;case 4:return e.label++,{value:h[1],done:!1};case 5:e.label++,i=h[1],h=[0];continue;case 7:h=e.ops.pop(),e.trys.pop();continue;default:if(!(o=(o=e.trys).length>0&&o[o.length-1])&&(6===h[0]||2===h[0])){e=0;continue}if(3===h[0]&&(!o||h[1]>o[0]&&h[1]<o[3])){e.label=h[1];break}if(6===h[0]&&e.label<o[1]){e.label=o[1],o=h;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(h);break}o[2]&&e.ops.pop(),e.trys.pop();continue}h=t.call(n,e)}catch(S){h=[6,S],i=0}finally{r=o=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([h,S])}}},dn=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.members=new hn,i}return ln(t,n),t.prototype.authorize=function(e,r){var i=this;n.prototype.authorize.call(this,e,function(o,s){return fn(i,void 0,void 0,function(){var u,p;return pn(this,function(h){switch(h.label){case 0:return o?[3,3]:null==s.channel_data?[3,1]:(u=JSON.parse(s.channel_data),this.members.setMyID(u.user_id),[3,3]);case 1:return[4,this.pusher.user.signinDonePromise];case 2:if(h.sent(),null==this.pusher.user.user_data)return p=v_buildLogSuffix("authorizationEndpoint"),A.error("Invalid auth response for channel '"+this.name+"', expected 'channel_data' field. "+p+", or the user should be signed in."),r("Invalid auth response"),[2];this.members.setMyID(this.pusher.user.user_data.id),h.label=3;case 3:return r(o,s),[2]}})})})},t.prototype.handleEvent=function(e){var r=e.event;if(0===r.indexOf("pusher_internal:"))this.handleInternalEvent(e);else{var i=e.data,o={};e.user_id&&(o.user_id=e.user_id),this.emit(r,i,o)}},t.prototype.handleInternalEvent=function(e){var i=e.data;switch(e.event){case"pusher_internal:subscription_succeeded":this.handleSubscriptionSucceededEvent(e);break;case"pusher_internal:subscription_count":this.handleSubscriptionCountEvent(e);break;case"pusher_internal:member_added":var o=this.members.addMember(i);this.emit("pusher:member_added",o);break;case"pusher_internal:member_removed":var s=this.members.removeMember(i);s&&this.emit("pusher:member_removed",s)}},t.prototype.handleSubscriptionSucceededEvent=function(e){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):(this.members.onSubscription(e.data),this.emit("pusher:subscription_succeeded",this.members))},t.prototype.disconnect=function(){this.members.reset(),n.prototype.disconnect.call(this)},t}(pt),vn=dn,gn=T(1),dt=T(0),yn=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])})(t,e)};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),mn=function(n){function t(e,r,i){var o=n.call(this,e,r)||this;return o.key=null,o.nacl=i,o}return yn(t,n),t.prototype.authorize=function(e,r){var i=this;n.prototype.authorize.call(this,e,function(o,s){if(o)r(o,s);else{var u=s.shared_secret;u?(i.key=Object(dt.decode)(u),delete s.shared_secret,r(null,s)):r(new Error("No shared_secret key in auth payload for encrypted channel: "+i.name),null)}})},t.prototype.trigger=function(e,r){throw new F("Client events are not currently supported for encrypted channels")},t.prototype.handleEvent=function(e){var r=e.event,i=e.data;0!==r.indexOf("pusher_internal:")&&0!==r.indexOf("pusher:")?this.handleEncryptedEvent(r,i):n.prototype.handleEvent.call(this,e)},t.prototype.handleEncryptedEvent=function(e,r){var i=this;if(this.key)if(r.ciphertext&&r.nonce){var o=Object(dt.decode)(r.ciphertext);if(o.length<this.nacl.secretbox.overheadLength)A.error("Expected encrypted event ciphertext length to be "+this.nacl.secretbox.overheadLength+", got: "+o.length);else{var s=Object(dt.decode)(r.nonce);if(s.length<this.nacl.secretbox.nonceLength)A.error("Expected encrypted event nonce length to be "+this.nacl.secretbox.nonceLength+", got: "+s.length);else{var u=this.nacl.secretbox.open(o,s,this.key);if(null===u)return A.debug("Failed to decrypt an event, probably because it was encrypted with a different key. Fetching a new key from the authEndpoint..."),void this.authorize(this.pusher.connection.socket_id,function(p,h){p?A.error("Failed to make a request to the authEndpoint: "+h+". Unable to fetch new key, so dropping encrypted event"):null!==(u=i.nacl.secretbox.open(o,s,i.key))?i.emit(e,i.getDataToEmit(u)):A.error("Failed to decrypt event with new key. Dropping encrypted event")});this.emit(e,this.getDataToEmit(u))}}}else A.error("Unexpected format for encrypted event, expected object with `ciphertext` and `nonce` fields, got: "+r);else A.debug("Received encrypted event before key has been retrieved from the authEndpoint")},t.prototype.getDataToEmit=function(e){var r=Object(gn.decode)(e);try{return JSON.parse(r)}catch{return r}},t}(pt),_n=mn,bn=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])})(t,e)};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),wn=function(n){function t(e,r){var i=n.call(this)||this;i.state="initialized",i.connection=null,i.key=e,i.options=r,i.timeline=i.options.timeline,i.usingTLS=i.options.useTLS,i.errorCallbacks=i.buildErrorCallbacks(),i.connectionCallbacks=i.buildConnectionCallbacks(i.errorCallbacks),i.handshakeCallbacks=i.buildHandshakeCallbacks(i.errorCallbacks);var o=y.getNetwork();return o.bind("online",function(){i.timeline.info({netinfo:"online"}),("connecting"===i.state||"unavailable"===i.state)&&i.retryIn(0)}),o.bind("offline",function(){i.timeline.info({netinfo:"offline"}),i.connection&&i.sendActivityCheck()}),i.updateStrategy(),i}return bn(t,n),t.prototype.connect=function(){if(!this.connection&&!this.runner){if(!this.strategy.isSupported())return void this.updateState("failed");this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()}},t.prototype.send=function(e){return!!this.connection&&this.connection.send(e)},t.prototype.send_event=function(e,r,i){return!!this.connection&&this.connection.send_event(e,r,i)},t.prototype.disconnect=function(){this.disconnectInternally(),this.updateState("disconnected")},t.prototype.isUsingTLS=function(){return this.usingTLS},t.prototype.startConnecting=function(){var e=this,r=function(i,o){i?e.runner=e.strategy.connect(0,r):"error"===o.action?(e.emit("error",{type:"HandshakeError",error:o.error}),e.timeline.error({handshakeError:o.error})):(e.abortConnecting(),e.handshakeCallbacks[o.action](o))};this.runner=this.strategy.connect(0,r)},t.prototype.abortConnecting=function(){this.runner&&(this.runner.abort(),this.runner=null)},t.prototype.disconnectInternally=function(){this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.connection&&this.abandonConnection().close()},t.prototype.updateStrategy=function(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,useTLS:this.usingTLS})},t.prototype.retryIn=function(e){var r=this;this.timeline.info({action:"retry",delay:e}),e>0&&this.emit("connecting_in",Math.round(e/1e3)),this.retryTimer=new G(e||0,function(){r.disconnectInternally(),r.connect()})},t.prototype.clearRetryTimer=function(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)},t.prototype.setUnavailableTimer=function(){var e=this;this.unavailableTimer=new G(this.options.unavailableTimeout,function(){e.updateState("unavailable")})},t.prototype.clearUnavailableTimer=function(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()},t.prototype.sendActivityCheck=function(){var e=this;this.stopActivityCheck(),this.connection.ping(),this.activityTimer=new G(this.options.pongTimeout,function(){e.timeline.error({pong_timed_out:e.options.pongTimeout}),e.retryIn(0)})},t.prototype.resetActivityCheck=function(){var e=this;this.stopActivityCheck(),this.connection&&!this.connection.handlesActivityChecks()&&(this.activityTimer=new G(this.activityTimeout,function(){e.sendActivityCheck()}))},t.prototype.stopActivityCheck=function(){this.activityTimer&&this.activityTimer.ensureAborted()},t.prototype.buildConnectionCallbacks=function(e){var r=this;return I({},e,{message:function(i){r.resetActivityCheck(),r.emit("message",i)},ping:function(){r.send_event("pusher:pong",{})},activity:function(){r.resetActivityCheck()},error:function(i){r.emit("error",i)},closed:function(){r.abandonConnection(),r.shouldRetry()&&r.retryIn(1e3)}})},t.prototype.buildHandshakeCallbacks=function(e){var r=this;return I({},e,{connected:function(i){r.activityTimeout=Math.min(r.options.activityTimeout,i.activityTimeout,i.connection.activityTimeout||1/0),r.clearUnavailableTimer(),r.setConnection(i.connection),r.socket_id=r.connection.id,r.updateState("connected",{socket_id:r.socket_id})}})},t.prototype.buildErrorCallbacks=function(){var e=this,r=function(i){return function(o){o.error&&e.emit("error",{type:"WebSocketError",error:o.error}),i(o)}};return{tls_only:r(function(){e.usingTLS=!0,e.updateStrategy(),e.retryIn(0)}),refused:r(function(){e.disconnect()}),backoff:r(function(){e.retryIn(1e3)}),retry:r(function(){e.retryIn(0)})}},t.prototype.setConnection=function(e){for(var r in this.connection=e,this.connectionCallbacks)this.connection.bind(r,this.connectionCallbacks[r]);this.resetActivityCheck()},t.prototype.abandonConnection=function(){if(this.connection){for(var e in this.stopActivityCheck(),this.connectionCallbacks)this.connection.unbind(e,this.connectionCallbacks[e]);var r=this.connection;return this.connection=null,r}},t.prototype.updateState=function(e,r){var i=this.state;if(this.state=e,i!==e){var o=e;"connected"===o&&(o+=" with new socket ID "+r.socket_id),A.debug("State changed",i+" -> "+o),this.timeline.info({state:e,params:r}),this.emit("state_change",{previous:i,current:e}),this.emit(e,r)}},t.prototype.shouldRetry=function(){return"connecting"===this.state||"connected"===this.state},t}(J),Sn=wn,Cn=function(){function n(){this.channels={}}return n.prototype.add=function(t,e){return this.channels[t]||(this.channels[t]=function kn(n,t){if(0===n.indexOf("private-encrypted-")){if(t.config.nacl)return W.createEncryptedChannel(n,t,t.config.nacl);var e="Tried to subscribe to a private-encrypted- channel but no nacl implementation available",r=v_buildLogSuffix("encryptedChannelSupport");throw new F(e+". "+r)}if(0===n.indexOf("private-"))return W.createPrivateChannel(n,t);if(0===n.indexOf("presence-"))return W.createPresenceChannel(n,t);if(0===n.indexOf("#"))throw new g('Cannot create a channel with name "'+n+'".');return W.createChannel(n,t)}(t,e)),this.channels[t]},n.prototype.all=function(){return function le(n){var t=[];return X(n,function(e){t.push(e)}),t}(this.channels)},n.prototype.find=function(t){return this.channels[t]},n.prototype.remove=function(t){var e=this.channels[t];return delete this.channels[t],e},n.prototype.disconnect=function(){X(this.channels,function(t){t.disconnect()})},n}(),Tn=Cn;var Pn={createChannels:function(){return new Tn},createConnectionManager:function(n,t){return new Sn(n,t)},createChannel:function(n,t){return new ft(n,t)},createPrivateChannel:function(n,t){return new pt(n,t)},createPresenceChannel:function(n,t){return new vn(n,t)},createEncryptedChannel:function(n,t,e){return new _n(n,t,e)},createTimelineSender:function(n,t){return new rn(n,t)},createHandshake:function(n,t){return new en(n,t)},createAssistantToTheTransportManager:function(n,t,e){return new Ye(n,t,e)}},W=Pn,xn=function(){function n(t){this.options=t||{},this.livesLeft=this.options.lives||1/0}return n.prototype.getAssistant=function(t){return W.createAssistantToTheTransportManager(this,t,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})},n.prototype.isAlive=function(){return this.livesLeft>0},n.prototype.reportDeath=function(){this.livesLeft-=1},n}(),Nt=xn,On=function(){function n(t,e){this.strategies=t,this.loop=!!e.loop,this.failFast=!!e.failFast,this.timeout=e.timeout,this.timeoutLimit=e.timeoutLimit}return n.prototype.isSupported=function(){return Ot(this.strategies,j.method("isSupported"))},n.prototype.connect=function(t,e){var r=this,i=this.strategies,o=0,s=this.timeout,u=null,p=function(h,S){S?e(null,S):(o+=1,r.loop&&(o%=i.length),o<i.length?(s&&(s*=2,r.timeoutLimit&&(s=Math.min(s,r.timeoutLimit))),u=r.tryStrategy(i[o],t,{timeout:s,failFast:r.failFast},p)):e(!0))};return u=this.tryStrategy(i[o],t,{timeout:s,failFast:this.failFast},p),{abort:function(){u.abort()},forceMinPriority:function(h){t=h,u&&u.forceMinPriority(h)}}},n.prototype.tryStrategy=function(t,e,r,i){var o=null,s=null;return r.timeout>0&&(o=new G(r.timeout,function(){s.abort(),i(!0)})),s=t.connect(e,function(u,p){u&&o&&o.isRunning()&&!r.failFast||(o&&o.ensureAborted(),i(u,p))}),{abort:function(){o&&o.ensureAborted(),s.abort()},forceMinPriority:function(u){s.forceMinPriority(u)}}},n}(),Q=On,Ln=function(){function n(t){this.strategies=t}return n.prototype.isSupported=function(){return Ot(this.strategies,j.method("isSupported"))},n.prototype.connect=function(t,e){return function An(n,t,e){var r=kt(n,function(i,o,s,u){return i.connect(t,e(o,u))});return{abort:function(){et(r,Rn)},forceMinPriority:function(i){et(r,function(o){o.forceMinPriority(i)})}}}(this.strategies,t,function(r,i){return function(o,s){i[r].error=o,o?function En(n){return function de(n,t){for(var e=0;e<n.length;e++)if(!t(n[e],e,n))return!1;return!0}(n,function(t){return!!t.error})}(i)&&e(!0):(et(i,function(u){u.forceMinPriority(s.transport.priority)}),e(null,s))}})},n}(),vt=Ln;function Rn(n){!n.error&&!n.aborted&&(n.abort(),n.aborted=!0)}var jn=function(){function n(t,e,r){this.strategy=t,this.transports=e,this.ttl=r.ttl||18e5,this.usingTLS=r.useTLS,this.timeline=r.timeline}return n.prototype.isSupported=function(){return this.strategy.isSupported()},n.prototype.connect=function(t,e){var r=this.usingTLS,i=function Nn(n){var t=y.getLocalStorage();if(t)try{var e=t[gt(n)];if(e)return JSON.parse(e)}catch{Ut(n)}return null}(r),o=[this.strategy];if(i&&i.timestamp+this.ttl>=j.now()){var s=this.transports[i.transport];s&&(this.timeline.info({cached:!0,transport:i.transport,latency:i.latency}),o.push(new Q([s],{timeout:2*i.latency+1e3,failFast:!0})))}var u=j.now(),p=o.pop().connect(t,function h(S,E){S?(Ut(r),o.length>0?(u=j.now(),p=o.pop().connect(t,h)):e(S)):(function Un(n,t,e){var r=y.getLocalStorage();if(r)try{r[gt(n)]=ot({timestamp:j.now(),transport:t,latency:e})}catch{}}(r,E.transport.name,j.now()-u),e(null,E))});return{abort:function(){p.abort()},forceMinPriority:function(h){t=h,p&&p.forceMinPriority(h)}}},n}(),In=jn;function gt(n){return"pusherTransport"+(n?"TLS":"NonTLS")}function Ut(n){var t=y.getLocalStorage();if(t)try{delete t[gt(n)]}catch{}}var Mn=function(){function n(t,e){var r=e.delay;this.strategy=t,this.options={delay:r}}return n.prototype.isSupported=function(){return this.strategy.isSupported()},n.prototype.connect=function(t,e){var i,r=this.strategy,o=new G(this.options.delay,function(){i=r.connect(t,e)});return{abort:function(){o.ensureAborted(),i&&i.abort()},forceMinPriority:function(s){t=s,i&&i.forceMinPriority(s)}}},n}(),at=Mn,Dn=function(){function n(t,e,r){this.test=t,this.trueBranch=e,this.falseBranch=r}return n.prototype.isSupported=function(){return(this.test()?this.trueBranch:this.falseBranch).isSupported()},n.prototype.connect=function(t,e){return(this.test()?this.trueBranch:this.falseBranch).connect(t,e)},n}(),nt=Dn,Hn=function(){function n(t){this.strategy=t}return n.prototype.isSupported=function(){return this.strategy.isSupported()},n.prototype.connect=function(t,e){var r=this.strategy.connect(t,function(i,o){o&&r.abort(),e(i,o)});return r},n}(),Bn=Hn;function rt(n){return function(){return n.isSupported()}}var zn=function(n,t,e){var r={};function i(Vt,Yr,$r,Kr,Zr){var Qt=e(n,Vt,Yr,$r,Kr,Zr);return r[Vt]=Qt,Qt}var _t,o=Object.assign({},t,{hostNonTLS:n.wsHost+":"+n.wsPort,hostTLS:n.wsHost+":"+n.wssPort,httpPath:n.wsPath}),s=Object.assign({},o,{useTLS:!0}),u=Object.assign({},t,{hostNonTLS:n.httpHost+":"+n.httpPort,hostTLS:n.httpHost+":"+n.httpsPort,httpPath:n.httpPath}),p={loop:!0,timeout:15e3,timeoutLimit:6e4},h=new Nt({lives:2,minPingDelay:1e4,maxPingDelay:n.activityTimeout}),S=new Nt({lives:2,minPingDelay:1e4,maxPingDelay:n.activityTimeout}),E=i("ws","ws",3,o,h),z=i("wss","ws",3,s,h),Jr=i("sockjs","sockjs",1,u),zt=i("xhr_streaming","xhr_streaming",1,u,S),Wr=i("xdr_streaming","xdr_streaming",1,u,S),Ft=i("xhr_polling","xhr_polling",1,u),Gr=i("xdr_polling","xdr_polling",1,u),Xt=new Q([E],p),Vr=new Q([z],p),Qr=new Q([Jr],p),Jt=new Q([new nt(rt(zt),zt,Wr)],p),Wt=new Q([new nt(rt(Ft),Ft,Gr)],p),Gt=new Q([new nt(rt(Jt),new vt([Jt,new at(Wt,{delay:4e3})]),Wt)],p),mt=new nt(rt(Gt),Gt,Qr);return _t=new vt(t.useTLS?[Xt,new at(mt,{delay:2e3})]:[Xt,new at(Vr,{delay:2e3}),new at(mt,{delay:5e3})]),new In(new Bn(new nt(rt(E),_t,mt)),r,{ttl:18e5,timeline:t.timeline,useTLS:t.useTLS})},Xn={getRequest:function(n){var t=new window.XDomainRequest;return t.ontimeout=function(){n.emit("error",new O),n.close()},t.onerror=function(e){n.emit("error",e),n.close()},t.onprogress=function(){t.responseText&&t.responseText.length>0&&n.onChunk(200,t.responseText)},t.onload=function(){t.responseText&&t.responseText.length>0&&n.onChunk(200,t.responseText),n.emit("finished",200),n.close()},t},abortRequest:function(n){n.ontimeout=n.onerror=n.onprogress=n.onload=null,n.abort()}},Jn=Xn,Wn=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])})(t,e)};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Vn=function(n){function t(e,r,i){var o=n.call(this)||this;return o.hooks=e,o.method=r,o.url=i,o}return Wn(t,n),t.prototype.start=function(e){var r=this;this.position=0,this.xhr=this.hooks.getRequest(this),this.unloader=function(){r.close()},y.addUnloadListener(this.unloader),this.xhr.open(this.method,this.url,!0),this.xhr.setRequestHeader&&this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(e)},t.prototype.close=function(){this.unloader&&(y.removeUnloadListener(this.unloader),this.unloader=null),this.xhr&&(this.hooks.abortRequest(this.xhr),this.xhr=null)},t.prototype.onChunk=function(e,r){for(;;){var i=this.advanceBuffer(r);if(!i)break;this.emit("chunk",{status:e,data:i})}this.isBufferTooLong(r)&&this.emit("buffer_too_long")},t.prototype.advanceBuffer=function(e){var r=e.slice(this.position),i=r.indexOf("\n");return-1!==i?(this.position+=i+1,r.slice(0,i)):null},t.prototype.isBufferTooLong=function(e){return this.position===e.length&&e.length>262144},t}(J),Qn=Vn,B=(()=>((B=B||{})[B.CONNECTING=0]="CONNECTING",B[B.OPEN=1]="OPEN",B[B.CLOSED=3]="CLOSED",B))(),Y=B,Yn=1,$n=function(){function n(t,e){this.hooks=t,this.session=Dt(1e3)+"/"+function er(n){for(var t=[],e=0;e<n;e++)t.push(Dt(32).toString(32));return t.join("")}(8),this.location=function Kn(n){var t=/([^\?]*)\/*(\??.*)/.exec(n);return{base:t[1],queryString:t[2]}}(e),this.readyState=Y.CONNECTING,this.openStream()}return n.prototype.send=function(t){return this.sendRaw(JSON.stringify([t]))},n.prototype.ping=function(){this.hooks.sendHeartbeat(this)},n.prototype.close=function(t,e){this.onClose(t,e,!0)},n.prototype.sendRaw=function(t){if(this.readyState!==Y.OPEN)return!1;try{return y.createSocketRequest("POST",Mt(function Zn(n,t){return n.base+"/"+t+"/xhr_send"}(this.location,this.session))).start(t),!0}catch{return!1}},n.prototype.reconnect=function(){this.closeStream(),this.openStream()},n.prototype.onClose=function(t,e,r){this.closeStream(),this.readyState=Y.CLOSED,this.onclose&&this.onclose({code:t,reason:e,wasClean:r})},n.prototype.onChunk=function(t){var e;if(200===t.status)switch(this.readyState===Y.OPEN&&this.onActivity(),t.data.slice(0,1)){case"o":e=JSON.parse(t.data.slice(1)||"{}"),this.onOpen(e);break;case"a":e=JSON.parse(t.data.slice(1)||"[]");for(var i=0;i<e.length;i++)this.onEvent(e[i]);break;case"m":e=JSON.parse(t.data.slice(1)||"null"),this.onEvent(e);break;case"h":this.hooks.onHeartbeat(this);break;case"c":e=JSON.parse(t.data.slice(1)||"[]"),this.onClose(e[0],e[1],!0)}},n.prototype.onOpen=function(t){this.readyState===Y.CONNECTING?(t&&t.hostname&&(this.location.base=function tr(n,t){var e=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(n);return e[1]+t+e[3]}(this.location.base,t.hostname)),this.readyState=Y.OPEN,this.onopen&&this.onopen()):this.onClose(1006,"Server lost session",!0)},n.prototype.onEvent=function(t){this.readyState===Y.OPEN&&this.onmessage&&this.onmessage({data:t})},n.prototype.onActivity=function(){this.onactivity&&this.onactivity()},n.prototype.onError=function(t){this.onerror&&this.onerror(t)},n.prototype.openStream=function(){var t=this;this.stream=y.createSocketRequest("POST",Mt(this.hooks.getReceiveURL(this.location,this.session))),this.stream.bind("chunk",function(e){t.onChunk(e)}),this.stream.bind("finished",function(e){t.hooks.onFinished(t,e)}),this.stream.bind("buffer_too_long",function(){t.reconnect()});try{this.stream.start()}catch(e){j.defer(function(){t.onError(e),t.onClose(1006,"Could not start streaming",!1)})}},n.prototype.closeStream=function(){this.stream&&(this.stream.unbind_all(),this.stream.close(),this.stream=null)},n}();function Mt(n){var t=-1===n.indexOf("?")?"?":"&";return n+t+"t="+ +new Date+"&n="+Yn++}function Dt(n){return y.randomInt(n)}var nr=$n,ir={getReceiveURL:function(n,t){return n.base+"/"+t+"/xhr_streaming"+n.queryString},onHeartbeat:function(n){n.sendRaw("[]")},sendHeartbeat:function(n){n.sendRaw("[]")},onFinished:function(n,t){n.onClose(1006,"Connection interrupted ("+t+")",!1)}},sr={getReceiveURL:function(n,t){return n.base+"/"+t+"/xhr"+n.queryString},onHeartbeat:function(){},sendHeartbeat:function(n){n.sendRaw("[]")},onFinished:function(n,t){200===t?n.reconnect():n.onClose(1006,"Connection interrupted ("+t+")",!1)}},ar={getRequest:function(n){var e=new(y.getXHRAPI());return e.onreadystatechange=e.onprogress=function(){switch(e.readyState){case 3:e.responseText&&e.responseText.length>0&&n.onChunk(e.status,e.responseText);break;case 4:e.responseText&&e.responseText.length>0&&n.onChunk(e.status,e.responseText),n.emit("finished",e.status),n.close()}},e},abortRequest:function(n){n.onreadystatechange=null,n.abort()}},cr=ar,ur={createStreamingSocket:function(n){return this.createSocket(ir,n)},createPollingSocket:function(n){return this.createSocket(sr,n)},createSocket:function(n,t){return new nr(n,t)},createXHR:function(n,t){return this.createRequest(cr,n,t)},createRequest:function(n,t,e){return new Qn(n,t,e)}},Ht=ur;Ht.createXDR=function(n,t){return this.createRequest(Jn,n,t)};var lr={nextAuthCallbackID:1,auth_callbacks:{},ScriptReceivers:l,DependenciesReceivers:k,getDefaultStrategy:zn,Transports:Je,transportConnectionInitializer:function(){var n=this;n.timeline.info(n.buildTimelineMessage({transport:n.name+(n.options.useTLS?"s":"")})),n.hooks.isInitialized()?n.changeState("initialized"):n.hooks.file?(n.changeState("initializing"),_.load(n.hooks.file,{useTLS:n.options.useTLS},function(t,e){n.hooks.isInitialized()?(n.changeState("initialized"),e(!0)):(t&&n.onError(t),n.onClose(),e(!1))})):n.onClose()},HTTPFactory:Ht,TimelineTransport:xe,getXHRAPI:function(){return window.XMLHttpRequest},getWebSocketAPI:function(){return window.WebSocket||window.MozWebSocket},setup:function(n){var t=this;window.Pusher=n;var e=function(){t.onDocumentBody(n.ready)};window.JSON?e():_.load("json2",{},e)},getDocument:function(){return document},getProtocol:function(){return this.getDocument().location.protocol},getAuthorizers:function(){return{ajax:$t,jsonp:be}},onDocumentBody:function(n){var t=this;document.body?n():setTimeout(function(){t.onDocumentBody(n)},0)},createJSONPRequest:function(n,t){return new Te(n,t)},createScriptRequest:function(n){return new Se(n)},getLocalStorage:function(){try{return window.localStorage}catch{return}},createXHR:function(){return this.getXHRAPI()?this.createXMLHttpRequest():this.createMicrosoftXHR()},createXMLHttpRequest:function(){return new(this.getXHRAPI())},createMicrosoftXHR:function(){return new ActiveXObject("Microsoft.XMLHTTP")},getNetwork:function(){return Ve},createWebSocket:function(n){return new(this.getWebSocketAPI())(n)},createSocketRequest:function(n,t){if(this.isXHRSupported())return this.HTTPFactory.createXHR(n,t);if(this.isXDRSupported(0===t.indexOf("https:")))return this.HTTPFactory.createXDR(n,t);throw"Cross-origin HTTP requests are not supported"},isXHRSupported:function(){var n=this.getXHRAPI();return!!n&&void 0!==(new n).withCredentials},isXDRSupported:function(n){var t=n?"https:":"http:",e=this.getProtocol();return!!window.XDomainRequest&&e===t},addUnloadListener:function(n){void 0!==window.addEventListener?window.addEventListener("unload",n,!1):void 0!==window.attachEvent&&window.attachEvent("onunload",n)},removeUnloadListener:function(n){void 0!==window.addEventListener?window.removeEventListener("unload",n,!1):void 0!==window.detachEvent&&window.detachEvent("onunload",n)},randomInt:function(n){return Math.floor((window.crypto||window.msCrypto).getRandomValues(new Uint32Array(1))[0]/Math.pow(2,32)*n)}},y=lr,q=(()=>((q=q||{})[q.ERROR=3]="ERROR",q[q.INFO=6]="INFO",q[q.DEBUG=7]="DEBUG",q))(),ct=q,fr=function(){function n(t,e,r){this.key=t,this.session=e,this.events=[],this.options=r||{},this.sent=0,this.uniqueID=0}return n.prototype.log=function(t,e){t<=this.options.level&&(this.events.push(I({},e,{timestamp:j.now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())},n.prototype.error=function(t){this.log(ct.ERROR,t)},n.prototype.info=function(t){this.log(ct.INFO,t)},n.prototype.debug=function(t){this.log(ct.DEBUG,t)},n.prototype.isEmpty=function(){return 0===this.events.length},n.prototype.send=function(t,e){var r=this,i=I({session:this.session,bundle:this.sent+1,key:this.key,lib:"js",version:this.options.version,cluster:this.options.cluster,features:this.options.features,timeline:this.events},this.options.params);return this.events=[],t(i,function(o,s){o||r.sent++,e&&e(o,s)}),!0},n.prototype.generateUniqueID=function(){return this.uniqueID++,this.uniqueID},n}(),pr=fr,dr=function(){function n(t,e,r,i){this.name=t,this.priority=e,this.transport=r,this.options=i||{}}return n.prototype.isSupported=function(){return this.transport.isSupported({useTLS:this.options.useTLS})},n.prototype.connect=function(t,e){var r=this;if(!this.isSupported())return Bt(new M,e);if(this.priority<t)return Bt(new L,e);var i=!1,o=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),s=null,u=function(){o.unbind("initialized",u),o.connect()},p=function(){s=W.createHandshake(o,function(z){i=!0,E(),e(null,z)})},h=function(z){E(),e(z)},S=function(){var z;E(),z=ot(o),e(new N(z))},E=function(){o.unbind("initialized",u),o.unbind("open",p),o.unbind("error",h),o.unbind("closed",S)};return o.bind("initialized",u),o.bind("open",p),o.bind("error",h),o.bind("closed",S),o.initialize(),{abort:function(){i||(E(),s?s.close():o.close())},forceMinPriority:function(z){i||r.priority<z&&(s?s.close():o.close())}}},n}(),vr=dr;function Bt(n,t){return j.defer(function(){t(n)}),{abort:function(){},forceMinPriority:function(){}}}var gr=y.Transports,yr=function(n,t,e,r,i,o){var p,s=gr[e];if(!s)throw new D(e);return n.enabledTransports&&-1===Ct(n.enabledTransports,t)||n.disabledTransports&&-1!==Ct(n.disabledTransports,t)?p=mr:(i=Object.assign({ignoreNullOrigin:n.ignoreNullOrigin},i),p=new vr(t,r,o?o.getAssistant(s):s,i)),p},mr={isSupported:function(){return!1},connect:function(n,t){var e=j.defer(function(){t(new M)});return{abort:function(){e.ensureAborted()},forceMinPriority:function(){}}}};var Sr=function(n){if(typeof y.getAuthorizers()[n.transport]>"u")throw"'"+n.transport+"' is not a recognized auth transport";return function(t,e){var r=function(n,t){var e="socket_id="+encodeURIComponent(n.socketId);for(var r in t.params)e+="&"+encodeURIComponent(r)+"="+encodeURIComponent(t.params[r]);if(null!=t.paramsProvider){var i=t.paramsProvider();for(var r in i)e+="&"+encodeURIComponent(r)+"="+encodeURIComponent(i[r])}return e}(t,n);y.getAuthorizers()[n.transport](y,r,n,c.UserAuthentication,e)}},kr=function(n){if(typeof y.getAuthorizers()[n.transport]>"u")throw"'"+n.transport+"' is not a recognized auth transport";return function(t,e){var r=function(n,t){var e="socket_id="+encodeURIComponent(n.socketId);for(var r in e+="&channel_name="+encodeURIComponent(n.channelName),t.params)e+="&"+encodeURIComponent(r)+"="+encodeURIComponent(t.params[r]);if(null!=t.paramsProvider){var i=t.paramsProvider();for(var r in i)e+="&"+encodeURIComponent(r)+"="+encodeURIComponent(i[r])}return e}(t,n);y.getAuthorizers()[n.transport](y,r,n,c.ChannelAuthorization,e)}},Pr=function(n,t,e){var r={authTransport:t.transport,authEndpoint:t.endpoint,auth:{params:t.params,headers:t.headers}};return function(i,o){var s=n.channel(i.channelName);e(s,r).authorize(i.socketId,o)}},Z=function(){return Z=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var i in t=arguments[e])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n},Z.apply(this,arguments)};function Or(n){return n.httpHost?n.httpHost:n.cluster?"sockjs-"+n.cluster+".pusher.com":b.httpHost}function Lr(n){return n.wsHost?n.wsHost:function Ar(n){return"ws-"+n+".pusher.com"}(n.cluster)}function Er(n){return"https:"===y.getProtocol()||!1!==n.forceTLS}function Rr(n){return"enableStats"in n?n.enableStats:"disableStats"in n&&!n.disableStats}function jr(n){var t=Z(Z({},b.userAuthentication),n.userAuthentication);return"customHandler"in t&&null!=t.customHandler?t.customHandler:Sr(t)}function Nr(n,t){var e=function Ir(n,t){var e;return"channelAuthorization"in n?e=Z(Z({},b.channelAuthorization),n.channelAuthorization):(e={transport:n.authTransport||b.authTransport,endpoint:n.authEndpoint||b.authEndpoint},"auth"in n&&("params"in n.auth&&(e.params=n.auth.params),"headers"in n.auth&&(e.headers=n.auth.headers)),"authorizer"in n&&(e.customHandler=Pr(t,e,n.authorizer))),e}(n,t);return"customHandler"in e&&null!=e.customHandler?e.customHandler:kr(e)}var Ur=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])})(t,e)};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Mr=function(n){function t(e){var r=n.call(this,function(i,o){A.debug("No callbacks on watchlist events for "+i)})||this;return r.pusher=e,r.bindWatchlistInternalEvent(),r}return Ur(t,n),t.prototype.handleEvent=function(e){var r=this;e.data.events.forEach(function(i){r.emit(i.name,i)})},t.prototype.bindWatchlistInternalEvent=function(){var e=this;this.pusher.connection.bind("message",function(r){"pusher_internal:watchlist_events"===r.event&&e.handleEvent(r)})},t}(J),Dr=Mr;var Br=function Hr(){var n,t;return{promise:new Promise(function(r,i){n=r,t=i}),resolve:n,reject:t}},qr=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])})(t,e)};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),zr=function(n){function t(e){var r=n.call(this,function(i,o){A.debug("No callbacks on user for "+i)})||this;return r.signin_requested=!1,r.user_data=null,r.serverToUserChannel=null,r.signinDonePromise=null,r._signinDoneResolve=null,r._onAuthorize=function(i,o){if(i)return A.warn("Error during signin: "+i),void r._cleanup();r.pusher.send_event("pusher:signin",{auth:o.auth,user_data:o.user_data})},r.pusher=e,r.pusher.connection.bind("state_change",function(i){var o=i.previous,s=i.current;"connected"!==o&&"connected"===s&&r._signin(),"connected"===o&&"connected"!==s&&(r._cleanup(),r._newSigninPromiseIfNeeded())}),r.watchlist=new Dr(e),r.pusher.connection.bind("message",function(i){"pusher:signin_success"===i.event&&r._onSigninSuccess(i.data),r.serverToUserChannel&&r.serverToUserChannel.name===i.channel&&r.serverToUserChannel.handleEvent(i)}),r}return qr(t,n),t.prototype.signin=function(){this.signin_requested||(this.signin_requested=!0,this._signin())},t.prototype._signin=function(){this.signin_requested&&(this._newSigninPromiseIfNeeded(),"connected"===this.pusher.connection.state&&this.pusher.config.userAuthenticator({socketId:this.pusher.connection.socket_id},this._onAuthorize))},t.prototype._onSigninSuccess=function(e){try{this.user_data=JSON.parse(e.user_data)}catch{return A.error("Failed parsing user data after signin: "+e.user_data),void this._cleanup()}if("string"!=typeof this.user_data.id||""===this.user_data.id)return A.error("user_data doesn't contain an id. user_data: "+this.user_data),void this._cleanup();this._signinDoneResolve(),this._subscribeChannels()},t.prototype._subscribeChannels=function(){var i,e=this;this.serverToUserChannel=new ft("#server-to-user-"+this.user_data.id,this.pusher),this.serverToUserChannel.bind_global(function(i,o){0===i.indexOf("pusher_internal:")||0===i.indexOf("pusher:")||e.emit(i,o)}),(i=this.serverToUserChannel).subscriptionPending&&i.subscriptionCancelled?i.reinstateSubscription():!i.subscriptionPending&&"connected"===e.pusher.connection.state&&i.subscribe()},t.prototype._cleanup=function(){this.user_data=null,this.serverToUserChannel&&(this.serverToUserChannel.unbind_all(),this.serverToUserChannel.disconnect(),this.serverToUserChannel=null),this.signin_requested&&this._signinDoneResolve()},t.prototype._newSigninPromiseIfNeeded=function(){if(this.signin_requested&&(!this.signinDonePromise||this.signinDonePromise.done)){var e=Br(),r=e.promise,i=e.resolve;r.done=!1;var s=function(){r.done=!0};r.then(s).catch(s),this.signinDonePromise=r,this._signinDoneResolve=i}},t}(J),Fr=zr,qt=function(){function n(t,e){var r=this;(function Xr(n){if(null==n)throw"You must pass your app key when you instantiate Pusher."})(t),function _r(n){if(null==n)throw"You must pass an options object";if(null==n.cluster)throw"Options object must provide a cluster";"disableStats"in n&&A.warn("The disableStats option is deprecated in favor of enableStats")}(e),this.key=t,this.config=function xr(n,t){var e={activityTimeout:n.activityTimeout||b.activityTimeout,cluster:n.cluster,httpPath:n.httpPath||b.httpPath,httpPort:n.httpPort||b.httpPort,httpsPort:n.httpsPort||b.httpsPort,pongTimeout:n.pongTimeout||b.pongTimeout,statsHost:n.statsHost||b.stats_host,unavailableTimeout:n.unavailableTimeout||b.unavailableTimeout,wsPath:n.wsPath||b.wsPath,wsPort:n.wsPort||b.wsPort,wssPort:n.wssPort||b.wssPort,enableStats:Rr(n),httpHost:Or(n),useTLS:Er(n),wsHost:Lr(n),userAuthenticator:jr(n),channelAuthorizer:Nr(n,t)};return"disabledTransports"in n&&(e.disabledTransports=n.disabledTransports),"enabledTransports"in n&&(e.enabledTransports=n.enabledTransports),"ignoreNullOrigin"in n&&(e.ignoreNullOrigin=n.ignoreNullOrigin),"timelineParams"in n&&(e.timelineParams=n.timelineParams),"nacl"in n&&(e.nacl=n.nacl),e}(e,this),this.channels=W.createChannels(),this.global_emitter=new J,this.sessionID=y.randomInt(1e9),this.timeline=new pr(this.key,this.sessionID,{cluster:this.config.cluster,features:n.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:ct.INFO,version:b.VERSION}),this.config.enableStats&&(this.timelineSender=W.createTimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/"+y.TimelineTransport.name})),this.connection=W.createConnectionManager(this.key,{getStrategy:function(o){return y.getDefaultStrategy(r.config,o,yr)},timeline:this.timeline,activityTimeout:this.config.activityTimeout,pongTimeout:this.config.pongTimeout,unavailableTimeout:this.config.unavailableTimeout,useTLS:!!this.config.useTLS}),this.connection.bind("connected",function(){r.subscribeAll(),r.timelineSender&&r.timelineSender.send(r.connection.isUsingTLS())}),this.connection.bind("message",function(o){var u=0===o.event.indexOf("pusher_internal:");if(o.channel){var p=r.channel(o.channel);p&&p.handleEvent(o)}u||r.global_emitter.emit(o.event,o.data)}),this.connection.bind("connecting",function(){r.channels.disconnect()}),this.connection.bind("disconnected",function(){r.channels.disconnect()}),this.connection.bind("error",function(o){A.warn(o)}),n.instances.push(this),this.timeline.info({instances:n.instances.length}),this.user=new Fr(this),n.isReady&&this.connect()}return n.ready=function(){n.isReady=!0;for(var t=0,e=n.instances.length;t<e;t++)n.instances[t].connect()},n.getClientFeatures=function(){return Tt(xt({ws:y.Transports.ws},function(t){return t.isSupported({})}))},n.prototype.channel=function(t){return this.channels.find(t)},n.prototype.allChannels=function(){return this.channels.all()},n.prototype.connect=function(){if(this.connection.connect(),this.timelineSender&&!this.timelineSenderTimer){var t=this.connection.isUsingTLS(),e=this.timelineSender;this.timelineSenderTimer=new ce(6e4,function(){e.send(t)})}},n.prototype.disconnect=function(){this.connection.disconnect(),this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)},n.prototype.bind=function(t,e,r){return this.global_emitter.bind(t,e,r),this},n.prototype.unbind=function(t,e,r){return this.global_emitter.unbind(t,e,r),this},n.prototype.bind_global=function(t){return this.global_emitter.bind_global(t),this},n.prototype.unbind_global=function(t){return this.global_emitter.unbind_global(t),this},n.prototype.unbind_all=function(t){return this.global_emitter.unbind_all(),this},n.prototype.subscribeAll=function(){var t;for(t in this.channels.channels)this.channels.channels.hasOwnProperty(t)&&this.subscribe(t)},n.prototype.subscribe=function(t){var e=this.channels.add(t,this);return e.subscriptionPending&&e.subscriptionCancelled?e.reinstateSubscription():!e.subscriptionPending&&"connected"===this.connection.state&&e.subscribe(),e},n.prototype.unsubscribe=function(t){var e=this.channels.find(t);e&&e.subscriptionPending?e.cancelSubscription():(e=this.channels.remove(t))&&e.subscribed&&e.unsubscribe()},n.prototype.send_event=function(t,e,r){return this.connection.send_event(t,e,r)},n.prototype.shouldUseTLS=function(){return this.config.useTLS},n.prototype.signin=function(){this.user.signin()},n.instances=[],n.isReady=!1,n.logToConsole=!1,n.Runtime=y,n.ScriptReceivers=y.ScriptReceivers,n.DependenciesReceivers=y.DependenciesReceivers,n.auth_callbacks=y.auth_callbacks,n}(),yt=C.default=qt;y.setup(qt)}])}}]);