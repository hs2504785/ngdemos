"use strict";(self.webpackChunkngdemos=self.webpackChunkngdemos||[]).push([[5173],{5173:(Y,w,x)=>{x.r(w),x.d(w,{IdbSampleModule:()=>V});var D=x(4755),T=x(9085),O=x(4128),q=x(3900),c=x(2223),B=x(5861),b=x(9751),I=x(188),P=x(9841),$=x(7579),k=x(5698);function f(d,u,e,r){return new Promise((t,n)=>{d||n("IndexedDB not available");const o=d.open(u,e);let i;o.onsuccess=s=>{i=o.result,t(i)},o.onerror=s=>{n(`IndexedDB error: ${o.error}`)},"function"==typeof r&&(o.onupgradeneeded=s=>{r(s,i)})})}function M(d,u,e,r,t){if(!d)return;const n=d.open(u,e);n.onupgradeneeded=o=>{const i=o.target.result;r.forEach(a=>{if(!i.objectStoreNames.contains(a.store)){const h=i.createObjectStore(a.store,a.storeConfig);a.storeSchema.forEach(l=>{h.createIndex(l.name,l.keypath,l.options)})}});const s=t&&t();s&&Object.keys(s).map(a=>parseInt(a,10)).filter(a=>a>o.oldVersion).sort((a,h)=>a-h).forEach(a=>{s[a](i,n.transaction)}),i.close()},n.onsuccess=o=>{o.target.result.close()}}function y(d,u,e){d||e("You need to use the openDatabase function to create a database before you query it!"),function K(d,u){return d.objectStoreNames.contains(u)}(d,u)||e(`objectStore does not exists: ${u}`)}function g(d,u){const e=d.transaction(u.storeName,u.dbMode);return e.onerror=u.error,e.onabort=u.abort,e}function S(d,u,e,r){return{storeName:u,dbMode:d,error:t=>{e(t)},abort:t=>{e(t)}}}var m=(()=>((m=m||{}).readonly="readonly",m.readwrite="readwrite",m))();const E=new c.InjectionToken(null);let A=(()=>{class d{constructor(e,r){if(this.dbConfigs=e,this.platformId=r,this.defaultDatabaseName=null,this.isBrowser=(0,D.NF)(this.platformId),this.isBrowser){this.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;const t=Object.values(this.dbConfigs),n=1===t.length;for(const o of t)this.instanciateConfig(o,n)}}instanciateConfig(e,r){if(!e.name)throw new Error("NgxIndexedDB: Please, provide the dbName in the configuration");if(!e.version)throw new Error("NgxIndexedDB: Please, provide the db version in the configuration");if(e.isDefault&&this.defaultDatabaseName)throw new Error("NgxIndexedDB: Only one database can be set as default");((e.isDefault??!1)&&!this.defaultDatabaseName||r)&&(this.defaultDatabaseName=e.name,this.selectedDb=e.name),M(this.indexedDB,e.name,e.version,e.objectStoresMeta,e.migrationFactory),f(this.indexedDB,e.name).then(t=>{t.version!==e.version&&(this.dbConfigs[e.name].version=t.version)})}get dbConfig(){return this.dbConfigs[this.selectedDb]}selectDb(e){if(!(e=e??this.defaultDatabaseName))throw new Error("No database name specified and no default database set.");if(!Object.keys(this.dbConfigs).includes(e))throw new Error(`NgxIndexedDB: Database ${e} is not initialized.`);this.selectedDb=e}createObjectStore(e,r){const t=[e];M(this.indexedDB,this.dbConfig.name,++this.dbConfig.version,t,r)}add(e,r,t){return new b.y(n=>{f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(o=>{const s=g(o,S(m.readwrite,e,h=>n.error(h))).objectStore(e),a=t?s.add(r,t):s.add(r);a.onsuccess=function(){var h=(0,B.Z)(function*(l){const v=s.get(l.target.result);v.onsuccess=C=>{n.next(C.target.result),n.complete()},v.onerror=C=>{n.error(C)}});return function(l){return h.apply(this,arguments)}}(),a.onerror=h=>{n.error(h)}}).catch(o=>n.error(o))})}bulkAdd(e,r){const t=new Promise((n,o)=>{f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(i=>{const a=g(i,S(m.readwrite,e,n)).objectStore(e),h=r.map(l=>new Promise((p,v)=>{const C=l.key;delete l.key,(C?a.add(l,C):a.add(l)).onsuccess=L=>{p(L.target.result)}}));n(Promise.all(h))}).catch(i=>o(i))});return(0,I.D)(t)}bulkDelete(e,r){const t=r.map(n=>new Promise((o,i)=>{f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(s=>{const a=g(s,S(m.readwrite,e,i));a.objectStore(e).delete(n),a.oncomplete=()=>{this.getAll(e).pipe((0,k.q)(1)).subscribe(l=>{o(l)})}}).catch(s=>i(s))}));return(0,I.D)(Promise.all(t))}getByKey(e,r){return new b.y(t=>{f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(n=>{const s=g(n,S(m.readonly,e,t.error)).objectStore(e).get(r);s.onsuccess=a=>{t.next(a.target.result),t.complete()},s.onerror=a=>{t.error(a)}}).catch(n=>t.error(n))})}bulkGet(e,r){const t=r.map(n=>this.getByKey(e,n));return new b.y(n=>{(0,P.a)(t).subscribe(o=>{n.next(o),n.complete()})})}getByID(e,r){return new b.y(t=>{f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(n=>{y(n,e,a=>t.error(a)),g(n,S(m.readonly,e,t.error)).objectStore(e).get(r).onsuccess=a=>{t.next(a.target.result)}}).catch(n=>t.error(n))})}getByIndex(e,r,t){return new b.y(n=>{f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(o=>{y(o,e,l=>n.error(l)),g(o,S(m.readonly,e,n.error)).objectStore(e).index(r).get(t).onsuccess=l=>{n.next(l.target.result),n.complete()}}).catch(o=>n.error(o))})}getAll(e){return new b.y(r=>{f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(t=>{y(t,e,s=>r.error(s));const i=g(t,S(m.readonly,e,r.error)).objectStore(e).getAll();i.onerror=s=>{r.error(s)},i.onsuccess=({target:{result:s}})=>{r.next(s),r.complete()}}).catch(t=>r.error(t))})}update(e,r){return new b.y(t=>{f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(n=>{y(n,e,a=>t.error(a));const i=g(n,S(m.readwrite,e,a=>t.error(a))).objectStore(e);i.put(r).onsuccess=function(){var a=(0,B.Z)(function*(h){i.get(h.target.result).onsuccess=v=>{t.next(v.target.result),t.complete()}});return function(h){return a.apply(this,arguments)}}()}).catch(n=>t.error(n))})}bulkPut(e,r){let t;return new b.y(n=>{f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(o=>{y(o,e,s=>n.error(s)),t=g(o,S(m.readwrite,e,s=>n.error(s)));const i=t.objectStore(e);r.forEach((s,a)=>{const h=i.put(s);a===r.length-1&&(h.onsuccess=l=>{t.commit(),n.next(l.target.result),n.complete()}),h.onerror=l=>{t.abort(),n.error(l)}})}).catch(o=>{t?.abort(),n.error(o)})})}delete(e,r){return new b.y(t=>{f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(n=>{y(n,e,s=>t.error(s));const o=g(n,S(m.readwrite,e,s=>t.error(s)));o.objectStore(e).delete(r),o.oncomplete=()=>{this.getAll(e).pipe((0,k.q)(1)).subscribe(s=>{t.next(s),t.complete()})}}).catch(n=>t.error(n))})}deleteByKey(e,r){return new b.y(t=>{f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(n=>{y(n,e,s=>t.error(s));const o=g(n,S(m.readwrite,e,s=>t.error(s))),i=o.objectStore(e);o.oncomplete=()=>{t.next(!0),t.complete()},i.delete(r)}).catch(n=>t.error(n))})}clear(e){return new b.y(r=>{f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(t=>{y(t,e,i=>r.error(i));const n=g(t,S(m.readwrite,e,i=>r.error(i)));n.objectStore(e).clear(),n.oncomplete=()=>{r.next(!0),r.complete()}}).catch(t=>r.error(t))})}deleteDatabase(){var e=this;return new b.y(r=>{f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(function(){var t=(0,B.Z)(function*(n){yield n.close();const o=e.indexedDB.deleteDatabase(e.dbConfig.name);o.onsuccess=()=>{r.next(!0),r.complete()},o.onerror=i=>r.error(i),o.onblocked=()=>{throw new Error("Unable to delete database because it's blocked")}});return function(n){return t.apply(this,arguments)}}()).catch(t=>r.error(t))})}openCursor(e,r){return new b.y(t=>{f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(n=>{y(n,e,a=>t.error(a));const i=g(n,S(m.readonly,e,t.error)).objectStore(e);(void 0===r?i.openCursor():i.openCursor(r)).onsuccess=a=>{t.next(a),t.complete()}}).catch(n=>t.error(n))})}openCursorByIndex(e,r,t,n=m.readonly){const o=new $.x;return f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(i=>{y(i,e,p=>{o.error(p)}),g(i,S(n,e,p=>{o.error(p)})).objectStore(e).index(r).openCursor(t).onsuccess=p=>{o.next(p)}}).catch(i=>o.error(i)),o}getAllByIndex(e,r,t){const n=[];return new b.y(o=>{f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(i=>{y(i,e,p=>o.error(p)),g(i,S(m.readonly,e,o.error)).objectStore(e).index(r).openCursor(t).onsuccess=p=>{const v=p.target.result;v?(n.push(v.value),v.continue()):(o.next(n),o.complete())}}).catch(i=>o.error(i))})}getAllKeysByIndex(e,r,t){const n=[];return new b.y(o=>{f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(i=>{y(i,e,p=>o.error(p)),g(i,S(m.readonly,e,o.error)).objectStore(e).index(r).openKeyCursor(t).onsuccess=p=>{const v=p.target.result;v?(n.push({primaryKey:v.primaryKey,key:v.key}),v.continue()):(o.next(n),o.complete())}}).catch(i=>o.error(i))})}count(e,r){return new b.y(t=>{f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(n=>{y(n,e,a=>t.error(a));const s=g(n,S(m.readonly,e,t.error)).objectStore(e).count(r);s.onerror=a=>t.error(a),s.onsuccess=a=>{t.next(a.target.result),t.complete()}}).catch(n=>t.error(n))})}countByIndex(e,r,t){return new b.y(n=>{f(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(o=>{y(o,e,l=>n.error(l));const h=g(o,S(m.readonly,e,n.error)).objectStore(e).index(r).count(t);h.onerror=l=>n.error(l),h.onsuccess=l=>{n.next(l.target.result),n.complete()}}).catch(o=>n.error(o))})}deleteObjectStore(e){return function G(d,u,e){if(!d||!u||!e)throw Error('Params: "dbName", "version", "storeName" are mandatory.');return new b.y(r=>{try{const n=indexedDB.open(d,u+1);n.onupgradeneeded=o=>{const i=o.target.result;i.deleteObjectStore(e),i.close(),console.log("onupgradeneeded"),r.next(!0),r.complete()},n.onerror=o=>r.error(o)}catch(t){r.error(t)}})}(this.dbConfig.name,++this.dbConfig.version,e)}}return d.\u0275fac=function(e){return new(e||d)(c.\u0275\u0275inject(E),c.\u0275\u0275inject(c.PLATFORM_ID))},d.\u0275prov=c.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac}),d})(),F=(()=>{class d{static forRoot(...e){const r={};for(const t of e)Object.assign(r,{[t.name]:t});return{ngModule:d,providers:[A,{provide:E,useValue:r}]}}}return d.\u0275fac=function(e){return new(e||d)},d.\u0275mod=c.\u0275\u0275defineNgModule({type:d}),d.\u0275inj=c.\u0275\u0275defineInjector({imports:[D.ez]}),d})();var j=x(9401);const z={name:"MyDb",version:1,objectStoresMeta:[{store:"people",storeConfig:{keyPath:"id",autoIncrement:!0},storeSchema:[{name:"name",keypath:"name",options:{unique:!1}},{name:"email",keypath:"email",options:{unique:!1}}]}]},J=[{path:"",component:(()=>{class d{constructor(e){this.dbService=e,this.title="playground"}add(){this.dbService.add("people",{name:"charles number "+10*Math.random(),email:"email number "+10*Math.random()}).subscribe(e=>{console.log("result: ",e)})}bulkAdd(){this.dbService.bulkAdd("people",[{name:"charles number "+10*Math.random(),email:"email number "+10*Math.random()},{name:"charles number "+10*Math.random(),email:"email number "+10*Math.random()}]).subscribe(e=>{console.log("result: ",e)})}bulkGet(){for(let e=0;e<3;e++)this.bulkAdd();this.dbService.bulkGet("people",[30,34,5]).subscribe(e=>{console.log("results: ",e)})}update(){this.dbService.update("people",{id:1,email:"asd",name:"charles"}).subscribe(e=>{console.log("result: ",e)})}delete(){this.dbService.delete("people",3).subscribe(e=>{console.log("result: ",e)})}clean(){this.dbService.clear("people").subscribe(e=>{console.log("result: ",e)})}count(){this.dbService.count("people").subscribe(e=>{console.log("result: ",e)})}createStote(e){console.log("storeName",e),this.dbService.createObjectStore({store:e,storeConfig:{keyPath:"id",autoIncrement:!0},storeSchema:[{name:"name",keypath:"name",options:{unique:!1}},{name:"email",keypath:"email",options:{unique:!1}}]})}addTwoAndGetAllByIndex(){(0,O.D)([this.dbService.add("people",{name:"desmond",email:"email number "+10*Math.random()}),this.dbService.add("people",{name:"desmond",email:"email number "+10*Math.random()})]).pipe((0,q.w)(()=>this.dbService.getAllByIndex("people","name",IDBKeyRange.only("desmond")))).subscribe(e=>console.log(e))}}return d.\u0275fac=function(e){return new(e||d)(c.\u0275\u0275directiveInject(A))},d.\u0275cmp=c.\u0275\u0275defineComponent({type:d,selectors:[["lib-idb-sample"]],decls:22,vars:1,consts:[[1,"container-fluid"],[3,"click"],["type","text","name","store",3,"ngModel","ngModelChange"],["store",""]],template:function(e,r){1&e&&(c.\u0275\u0275elementStart(0,"div",0)(1,"button",1),c.\u0275\u0275listener("click",function(){return r.add()}),c.\u0275\u0275text(2,"Add new entry"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(3,"button",1),c.\u0275\u0275listener("click",function(){return r.update()}),c.\u0275\u0275text(4,"Update entry"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(5,"button",1),c.\u0275\u0275listener("click",function(){return r.delete()}),c.\u0275\u0275text(6,"Delete entry"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(7,"button",1),c.\u0275\u0275listener("click",function(){return r.clean()}),c.\u0275\u0275text(8,"Clean"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(9,"button",1),c.\u0275\u0275listener("click",function(){return r.count()}),c.\u0275\u0275text(10,"Count"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(11,"button",1),c.\u0275\u0275listener("click",function(){return r.addTwoAndGetAllByIndex()}),c.\u0275\u0275text(12,"Test #209 getAllByIndex"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(13,"button",1),c.\u0275\u0275listener("click",function(){return r.bulkAdd()}),c.\u0275\u0275text(14,"bulkAdd"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(15,"button",1),c.\u0275\u0275listener("click",function(){return r.bulkGet()}),c.\u0275\u0275text(16,"bulkGet"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(17,"div")(18,"input",2,3),c.\u0275\u0275listener("ngModelChange",function(n){return r.storeName=n}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(20,"button",1),c.\u0275\u0275listener("click",function(){return r.createStote(r.storeName)}),c.\u0275\u0275text(21,"Create Store"),c.\u0275\u0275elementEnd()()()),2&e&&(c.\u0275\u0275advance(18),c.\u0275\u0275property("ngModel",r.storeName))},dependencies:[j.Fj,j.JJ,j.On]}),d})()}];let V=(()=>{class d{}return d.\u0275fac=function(e){return new(e||d)},d.\u0275mod=c.\u0275\u0275defineNgModule({type:d}),d.\u0275inj=c.\u0275\u0275defineInjector({imports:[D.ez,j.u5,T.Bz.forChild(J),F.forRoot(z)]}),d})()}}]);