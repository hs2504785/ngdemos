"use strict";(self.webpackChunkngdemos=self.webpackChunkngdemos||[]).push([[9727],{9727:(J,I,v)=>{v.r(I),v.d(I,{IdbSampleModule:()=>z});var x=v(6019),A=v(9843),C=v(6813),k=v(9204),l=v(3668),B=v(4762),g=v(5548),E=v(3534),G=v(2668),D=v(3405),M=v(6636);function m(o,i,e,n){return new Promise((r,t)=>{o||t("IndexedDB not available");const c=o.open(i,e);let s;c.onsuccess=u=>{s=c.result,r(s)},c.onerror=u=>{t(`IndexedDB error: ${c.error}`)},"function"==typeof n&&(c.onupgradeneeded=u=>{n(u,s)})})}function O(o,i,e,n,r){if(!o)return;const t=o.open(i,e);t.onupgradeneeded=c=>{const s=c.target.result;n.forEach(a=>{if(!s.objectStoreNames.contains(a.store)){const d=s.createObjectStore(a.store,a.storeConfig);a.storeSchema.forEach(h=>{d.createIndex(h.name,h.keypath,h.options)})}});const u=r&&r();u&&Object.keys(u).map(a=>parseInt(a,10)).filter(a=>a>c.oldVersion).sort((a,d)=>a-d).forEach(a=>{u[a](s,t.transaction)}),s.close()},t.onsuccess=c=>{c.target.result.close()}}function w(o,i,e){o||e("You need to use the openDatabase function to create a database before you query it!"),function(o,i){return o.objectStoreNames.contains(i)}(o,i)||e(`objectStore does not exists: ${i}`)}function S(o,i){const e=o.transaction(i.storeName,i.dbMode);return e.onerror=i.error,e.onabort=i.abort,e}function p(o,i,e,n){return{storeName:i,dbMode:o,error:r=>{e(r)},abort:r=>{e(r)}}}var b=(()=>{return(o=b||(b={})).readonly="readonly",o.readwrite="readwrite",b;var o})();const P=new l.InjectionToken(null);let T=(()=>{class o{constructor(e,n){if(this.dbConfig=e,this.platformId=n,!e.name)throw new Error("NgxIndexedDB: Please, provide the dbName in the configuration");if(!e.version)throw new Error("NgxIndexedDB: Please, provide the db version in the configuration");this.isBrowser=(0,x.NF)(this.platformId),this.isBrowser&&(this.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,O(this.indexedDB,e.name,e.version,e.objectStoresMeta,e.migrationFactory),m(this.indexedDB,e.name).then(r=>{r.version!==e.version&&(this.dbConfig.version=r.version)}))}createObjectStore(e,n){const r=[e];O(this.indexedDB,this.dbConfig.name,++this.dbConfig.version,r,n)}add(e,n,r){return new g.y(t=>{m(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(c=>{const u=S(c,p(b.readwrite,e,t.error)).objectStore(e);(Boolean(r)?u.add(n,r):u.add(n)).onsuccess=d=>(0,B.mG)(this,void 0,void 0,function*(){u.get(d.target.result).onsuccess=y=>{t.next(y.target.result),t.complete()}})}).catch(c=>t.error(c))})}bulkAdd(e,n){const r=n.map(t=>new Promise((c,s)=>{m(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(u=>{const d=S(u,p(b.readwrite,e,s)).objectStore(e),h=t.key;delete t.key,(Boolean(h)?d.add(t,h):d.add(t)).onsuccess=y=>{c(y.target.result)}}).catch(u=>s(u))}));return(0,C.D)(r)}bulkDelete(e,n){const r=n.map(t=>new Promise((c,s)=>{m(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(u=>{const a=S(u,p(b.readwrite,e,s));a.objectStore(e).delete(t),a.oncomplete=()=>{this.getAll(e).pipe((0,M.q)(1)).subscribe(h=>{c(h)})}}).catch(u=>s(u))}));return(0,E.D)(Promise.all(r))}getByKey(e,n){return new g.y(r=>{m(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(t=>{const u=S(t,p(b.readonly,e,r.error)).objectStore(e).get(n);u.onsuccess=a=>{r.next(a.target.result),r.complete()},u.onerror=a=>{r.error(a)}}).catch(t=>r.error(t))})}bulkGet(e,n){const r=n.map(t=>this.getByKey(e,t));return new g.y(t=>{(0,G.aj)(r).subscribe(c=>{t.next(c),t.complete()})})}getByID(e,n){return new g.y(r=>{m(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(t=>{w(t,e,r.error),S(t,p(b.readonly,e,r.error)).objectStore(e).get(n).onsuccess=a=>{r.next(a.target.result)}}).catch(t=>r.error(t))})}getByIndex(e,n,r){return new g.y(t=>{m(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(c=>{w(c,e,t.error),S(c,p(b.readonly,e,t.error)).objectStore(e).index(n).get(r).onsuccess=h=>{t.next(h.target.result),t.complete()}}).catch(c=>t.error(c))})}getAll(e){return new g.y(n=>{m(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(r=>{w(r,e,n.error);const s=S(r,p(b.readonly,e,n.error)).objectStore(e).getAll();s.onerror=u=>{n.error(u)},s.onsuccess=({target:{result:u}})=>{n.next(u),n.complete()}}).catch(r=>n.error(r))})}update(e,n,r){return new g.y(t=>{m(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(c=>{w(c,e,t.error);const s=S(c,p(b.readwrite,e,t.error)),u=s.objectStore(e);s.oncomplete=()=>{this.getAll(e).pipe((0,M.q)(1)).subscribe(a=>{t.next(a),t.complete()})},r?u.put(n,r):u.put(n)}).catch(c=>t.error(c))})}updateByKey(e,n,r){return new g.y(t=>{m(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(c=>{w(c,e,t.error);const s=S(c,p(b.readwrite,e,t.error)),u=s.objectStore(e);s.oncomplete=()=>{const a=u.get(r);a.onsuccess=d=>{t.next(d.target.result)},a.onerror=d=>{t.error(d)}},u.put(n,r)}).catch(c=>t.error(c))})}delete(e,n){return new g.y(r=>{m(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(t=>{w(t,e,r.error);const c=S(t,p(b.readwrite,e,r.error));c.objectStore(e).delete(n),c.oncomplete=()=>{this.getAll(e).pipe((0,M.q)(1)).subscribe(u=>{r.next(u),r.complete()})}}).catch(t=>r.error(t))})}deleteByKey(e,n){return new g.y(r=>{m(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(t=>{w(t,e,r.error);const c=S(t,p(b.readwrite,e,r.error)),s=c.objectStore(e);c.oncomplete=()=>{r.next(!0),r.complete()},s.delete(n)}).catch(t=>r.error(t))})}clear(e){return new g.y(n=>{m(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(r=>{w(r,e,n.error);const t=S(r,p(b.readwrite,e,n.error));t.objectStore(e).clear(),t.oncomplete=()=>{n.next(!0),n.complete()}}).catch(r=>n.error(r))})}deleteDatabase(){return new g.y(e=>{m(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(n=>(0,B.mG)(this,void 0,void 0,function*(){yield n.close();const r=this.indexedDB.deleteDatabase(this.dbConfig.name);r.onsuccess=()=>{e.next(!0),e.complete()},r.onerror=t=>e.error(t),r.onblocked=()=>{throw new Error("Unable to delete database because it's blocked")}})).catch(n=>e.error(n))})}openCursor(e,n){return new g.y(r=>{m(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(t=>{w(t,e,r.error);const s=S(t,p(b.readonly,e,r.error)).objectStore(e);(void 0===n?s.openCursor():s.openCursor(n)).onsuccess=a=>{r.next(a),r.complete()}}).catch(t=>r.error(t))})}openCursorByIndex(e,n,r,t=b.readonly){const c=new D.xQ;return m(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(s=>{w(s,e,f=>{c.error(f)}),S(s,p(t,e,f=>{c.error(f)})).objectStore(e).index(n).openCursor(r).onsuccess=f=>{c.next(f)}}).catch(s=>c.error(s)),c}getAllByIndex(e,n,r){const t=[];return new g.y(c=>{m(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(s=>{w(s,e,c.error),S(s,p(b.readonly,e,c.error)).objectStore(e).index(n).openCursor(r).onsuccess=f=>{const y=f.target.result;y?(t.push(y.value),y.continue()):(c.next(t),c.complete())}}).catch(s=>c.error(s))})}getAllKeysByIndex(e,n,r){const t=[];return new g.y(c=>{m(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(s=>{w(s,e,c.error),S(s,p(b.readonly,e,c.error)).objectStore(e).index(n).openKeyCursor(r).onsuccess=f=>{const y=f.target.result;y?(t.push({primaryKey:y.primaryKey,key:y.key}),y.continue()):(c.next(t),c.complete())}}).catch(s=>c.error(s))})}count(e,n){return new g.y(r=>{m(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(t=>{w(t,e,r.error);const u=S(t,p(b.readonly,e,r.error)).objectStore(e).count(n);u.onerror=a=>r.error(a),u.onsuccess=a=>{r.next(a.target.result),r.complete()}}).catch(t=>r.error(t))})}}return o.\u0275fac=function(e){return new(e||o)(l.\u0275\u0275inject(P),l.\u0275\u0275inject(l.PLATFORM_ID))},o.\u0275prov=l.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o})(),R=(()=>{class o{static forRoot(e){return{ngModule:o,providers:[T,{provide:P,useValue:e}]}}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=l.\u0275\u0275defineInjector({imports:[[x.ez]]}),o})();var j=v(9133);const K={name:"MyDb",version:1,objectStoresMeta:[{store:"people",storeConfig:{keyPath:"id",autoIncrement:!0},storeSchema:[{name:"name",keypath:"name",options:{unique:!1}},{name:"email",keypath:"email",options:{unique:!1}}]}]},$=[{path:"",component:(()=>{class o{constructor(e){this.dbService=e,this.title="playground"}add(){this.dbService.add("people",{name:"charles number "+10*Math.random(),email:"email number "+10*Math.random()}).subscribe(e=>{console.log("result: ",e)})}bulkAdd(){this.dbService.bulkAdd("people",[{name:"charles number "+10*Math.random(),email:"email number "+10*Math.random()},{name:"charles number "+10*Math.random(),email:"email number "+10*Math.random()}]).subscribe(e=>{console.log("result: ",e)})}bulkGet(){for(let e=0;e<3;e++)this.bulkAdd();this.dbService.bulkGet("people",[30,34,5]).subscribe(e=>{console.log("results: ",e)})}update(){this.dbService.update("people",{id:1,email:"asd",name:"charles"}).subscribe(e=>{console.log("result: ",e)})}delete(){this.dbService.delete("people",3).subscribe(e=>{console.log("result: ",e)})}clean(){this.dbService.clear("people").subscribe(e=>{console.log("result: ",e)})}count(){this.dbService.count("people").subscribe(e=>{console.log("result: ",e)})}createStote(e){console.log("storeName",e),this.dbService.createObjectStore({store:e,storeConfig:{keyPath:"id",autoIncrement:!0},storeSchema:[{name:"name",keypath:"name",options:{unique:!1}},{name:"email",keypath:"email",options:{unique:!1}}]})}addTwoAndGetAllByIndex(){(0,C.D)([this.dbService.add("people",{name:"desmond",email:"email number "+10*Math.random()}),this.dbService.add("people",{name:"desmond",email:"email number "+10*Math.random()})]).pipe((0,k.w)(()=>this.dbService.getAllByIndex("people","name",IDBKeyRange.only("desmond")))).subscribe(e=>console.log(e))}}return o.\u0275fac=function(e){return new(e||o)(l.\u0275\u0275directiveInject(T))},o.\u0275cmp=l.\u0275\u0275defineComponent({type:o,selectors:[["lib-idb-sample"]],decls:22,vars:1,consts:[[1,"container-fluid"],[3,"click"],["type","text","name","store",3,"ngModel","ngModelChange"],["store",""]],template:function(e,n){1&e&&(l.\u0275\u0275elementStart(0,"div",0),l.\u0275\u0275elementStart(1,"button",1),l.\u0275\u0275listener("click",function(){return n.add()}),l.\u0275\u0275text(2,"Add new entry"),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(3,"button",1),l.\u0275\u0275listener("click",function(){return n.update()}),l.\u0275\u0275text(4,"Update entry"),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(5,"button",1),l.\u0275\u0275listener("click",function(){return n.delete()}),l.\u0275\u0275text(6,"Delete entry"),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(7,"button",1),l.\u0275\u0275listener("click",function(){return n.clean()}),l.\u0275\u0275text(8,"Clean"),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(9,"button",1),l.\u0275\u0275listener("click",function(){return n.count()}),l.\u0275\u0275text(10,"Count"),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(11,"button",1),l.\u0275\u0275listener("click",function(){return n.addTwoAndGetAllByIndex()}),l.\u0275\u0275text(12,"Test #209 getAllByIndex"),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(13,"button",1),l.\u0275\u0275listener("click",function(){return n.bulkAdd()}),l.\u0275\u0275text(14,"bulkAdd"),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(15,"button",1),l.\u0275\u0275listener("click",function(){return n.bulkGet()}),l.\u0275\u0275text(16,"bulkGet"),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(17,"div"),l.\u0275\u0275elementStart(18,"input",2,3),l.\u0275\u0275listener("ngModelChange",function(t){return n.storeName=t}),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(20,"button",1),l.\u0275\u0275listener("click",function(){return n.createStote(n.storeName)}),l.\u0275\u0275text(21,"Create Store"),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd()),2&e&&(l.\u0275\u0275advance(18),l.\u0275\u0275property("ngModel",n.storeName))},directives:[j.Fj,j.JJ,j.On],styles:[""]}),o})()}];let z=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=l.\u0275\u0275defineInjector({imports:[[x.ez,j.u5,A.Bz.forChild($),R.forRoot(K)]]}),o})()},4762:(J,I,v)=>{function l(o,i,e,n){var c,r=arguments.length,t=r<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)t=Reflect.decorate(o,i,e,n);else for(var s=o.length-1;s>=0;s--)(c=o[s])&&(t=(r<3?c(t):r>3?c(i,e,t):c(i,e))||t);return r>3&&t&&Object.defineProperty(i,e,t),t}function B(o,i){return function(e,n){i(e,n,o)}}function g(o,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(o,i)}function E(o,i,e,n){return new(e||(e=Promise))(function(t,c){function s(d){try{a(n.next(d))}catch(h){c(h)}}function u(d){try{a(n.throw(d))}catch(h){c(h)}}function a(d){d.done?t(d.value):function(t){return t instanceof e?t:new e(function(c){c(t)})}(d.value).then(s,u)}a((n=n.apply(o,i||[])).next())})}v.d(I,{gn:()=>l,fM:()=>B,w6:()=>g,mG:()=>E})}}]);