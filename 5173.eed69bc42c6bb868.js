"use strict";(self.webpackChunkngdemos=self.webpackChunkngdemos||[]).push([[5173],{5173:(Y,k,x)=>{x.r(k),x.d(k,{IdbSampleModule:()=>C});var I=x(6895),O=x(9116),P=x(4128),G=x(3900),c=x(4650),w=x(5861),b=x(9751),M=x(188),$=x(9841),K=x(7579),A=x(5698);function p(l,s,e,r){return new Promise((t,n)=>{l||n("IndexedDB not available");const o=l.open(s,e);let i;o.onsuccess=a=>{i=o.result,t(i)},o.onerror=a=>{n(`IndexedDB error: ${o.error}`)},"function"==typeof r&&(o.onupgradeneeded=a=>{r(a,i)})})}function T(l,s,e,r,t){if(!l)return;const n=l.open(s,e);n.onupgradeneeded=o=>{const i=o.target.result;r.forEach(d=>{if(!i.objectStoreNames.contains(d.store)){const m=i.createObjectStore(d.store,d.storeConfig);d.storeSchema.forEach(u=>{m.createIndex(u.name,u.keypath,u.options)})}});const a=t&&t();a&&Object.keys(a).map(d=>parseInt(d,10)).filter(d=>d>o.oldVersion).sort((d,m)=>d-m).forEach(d=>{a[d](i,n.transaction)}),i.close()},n.onsuccess=o=>{o.target.result.close()}}function y(l,s,e){l||e("You need to use the openDatabase function to create a database before you query it!"),function R(l,s){return l.objectStoreNames.contains(s)}(l,s)||e(`objectStore does not exists: ${s}`)}function g(l,s){const e=l.transaction(s.storeName,s.dbMode);return e.onerror=s.error,e.onabort=s.abort,e}function S(l,s,e,r){return{storeName:s,dbMode:l,error:t=>{e(t)},abort:t=>{e(t)}}}var h=(()=>{return(l=h||(h={})).readonly="readonly",l.readwrite="readwrite",h;var l})();const E=new c.InjectionToken(null);let q=(()=>{class l{constructor(e,r){if(this.dbConfig=e,this.platformId=r,!e.name)throw new Error("NgxIndexedDB: Please, provide the dbName in the configuration");if(!e.version)throw new Error("NgxIndexedDB: Please, provide the db version in the configuration");this.isBrowser=(0,I.NF)(this.platformId),this.isBrowser&&(this.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,T(this.indexedDB,e.name,e.version,e.objectStoresMeta,e.migrationFactory),p(this.indexedDB,e.name).then(t=>{t.version!==e.version&&(this.dbConfig.version=t.version)}))}createObjectStore(e,r){const t=[e];T(this.indexedDB,this.dbConfig.name,++this.dbConfig.version,t,r)}add(e,r,t){return new b.y(n=>{p(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(o=>{const a=g(o,S(h.readwrite,e,m=>n.error(m))).objectStore(e);(Boolean(t)?a.add(r,t):a.add(r)).onsuccess=function(){var m=(0,w.Z)(function*(u){a.get(u.target.result).onsuccess=D=>{n.next(D.target.result),n.complete()}});return function(u){return m.apply(this,arguments)}}()}).catch(o=>n.error(o))})}bulkAdd(e,r){const t=new Promise((n,o)=>{p(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(i=>{const d=g(i,S(h.readwrite,e,n)).objectStore(e),m=r.map(u=>new Promise((f,v)=>{const D=u.key;delete u.key,(Boolean(D)?d.add(u,D):d.add(u)).onsuccess=L=>{f(L.target.result)}}));n(Promise.all(m))}).catch(i=>o(i))});return(0,M.D)(t)}bulkDelete(e,r){const t=r.map(n=>new Promise((o,i)=>{p(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(a=>{const d=g(a,S(h.readwrite,e,i));d.objectStore(e).delete(n),d.oncomplete=()=>{this.getAll(e).pipe((0,A.q)(1)).subscribe(u=>{o(u)})}}).catch(a=>i(a))}));return(0,M.D)(Promise.all(t))}getByKey(e,r){return new b.y(t=>{p(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(n=>{const a=g(n,S(h.readonly,e,t.error)).objectStore(e).get(r);a.onsuccess=d=>{t.next(d.target.result),t.complete()},a.onerror=d=>{t.error(d)}}).catch(n=>t.error(n))})}bulkGet(e,r){const t=r.map(n=>this.getByKey(e,n));return new b.y(n=>{(0,$.a)(t).subscribe(o=>{n.next(o),n.complete()})})}getByID(e,r){return new b.y(t=>{p(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(n=>{y(n,e,d=>t.error(d)),g(n,S(h.readonly,e,t.error)).objectStore(e).get(r).onsuccess=d=>{t.next(d.target.result)}}).catch(n=>t.error(n))})}getByIndex(e,r,t){return new b.y(n=>{p(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(o=>{y(o,e,u=>n.error(u)),g(o,S(h.readonly,e,n.error)).objectStore(e).index(r).get(t).onsuccess=u=>{n.next(u.target.result),n.complete()}}).catch(o=>n.error(o))})}getAll(e){return new b.y(r=>{p(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(t=>{y(t,e,a=>r.error(a));const i=g(t,S(h.readonly,e,r.error)).objectStore(e).getAll();i.onerror=a=>{r.error(a)},i.onsuccess=({target:{result:a}})=>{r.next(a),r.complete()}}).catch(t=>r.error(t))})}update(e,r){return new b.y(t=>{p(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(n=>{y(n,e,d=>t.error(d));const i=g(n,S(h.readwrite,e,d=>t.error(d))).objectStore(e);i.put(r).onsuccess=function(){var d=(0,w.Z)(function*(m){i.get(m.target.result).onsuccess=v=>{t.next(v.target.result),t.complete()}});return function(m){return d.apply(this,arguments)}}()}).catch(n=>t.error(n))})}delete(e,r){return new b.y(t=>{p(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(n=>{y(n,e,a=>t.error(a));const o=g(n,S(h.readwrite,e,a=>t.error(a)));o.objectStore(e).delete(r),o.oncomplete=()=>{this.getAll(e).pipe((0,A.q)(1)).subscribe(a=>{t.next(a),t.complete()})}}).catch(n=>t.error(n))})}deleteByKey(e,r){return new b.y(t=>{p(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(n=>{y(n,e,a=>t.error(a));const o=g(n,S(h.readwrite,e,a=>t.error(a))),i=o.objectStore(e);o.oncomplete=()=>{t.next(!0),t.complete()},i.delete(r)}).catch(n=>t.error(n))})}clear(e){return new b.y(r=>{p(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(t=>{y(t,e,i=>r.error(i));const n=g(t,S(h.readwrite,e,i=>r.error(i)));n.objectStore(e).clear(),n.oncomplete=()=>{r.next(!0),r.complete()}}).catch(t=>r.error(t))})}deleteDatabase(){var e=this;return new b.y(r=>{p(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(function(){var t=(0,w.Z)(function*(n){yield n.close();const o=e.indexedDB.deleteDatabase(e.dbConfig.name);o.onsuccess=()=>{r.next(!0),r.complete()},o.onerror=i=>r.error(i),o.onblocked=()=>{throw new Error("Unable to delete database because it's blocked")}});return function(n){return t.apply(this,arguments)}}()).catch(t=>r.error(t))})}openCursor(e,r){return new b.y(t=>{p(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(n=>{y(n,e,d=>t.error(d));const i=g(n,S(h.readonly,e,t.error)).objectStore(e);(void 0===r?i.openCursor():i.openCursor(r)).onsuccess=d=>{t.next(d),t.complete()}}).catch(n=>t.error(n))})}openCursorByIndex(e,r,t,n=h.readonly){const o=new K.x;return p(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(i=>{y(i,e,f=>{o.error(f)}),g(i,S(n,e,f=>{o.error(f)})).objectStore(e).index(r).openCursor(t).onsuccess=f=>{o.next(f)}}).catch(i=>o.error(i)),o}getAllByIndex(e,r,t){const n=[];return new b.y(o=>{p(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(i=>{y(i,e,f=>o.error(f)),g(i,S(h.readonly,e,o.error)).objectStore(e).index(r).openCursor(t).onsuccess=f=>{const v=f.target.result;v?(n.push(v.value),v.continue()):(o.next(n),o.complete())}}).catch(i=>o.error(i))})}getAllKeysByIndex(e,r,t){const n=[];return new b.y(o=>{p(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(i=>{y(i,e,f=>o.error(f)),g(i,S(h.readonly,e,o.error)).objectStore(e).index(r).openKeyCursor(t).onsuccess=f=>{const v=f.target.result;v?(n.push({primaryKey:v.primaryKey,key:v.key}),v.continue()):(o.next(n),o.complete())}}).catch(i=>o.error(i))})}count(e,r){return new b.y(t=>{p(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(n=>{y(n,e,d=>t.error(d));const a=g(n,S(h.readonly,e,t.error)).objectStore(e).count(r);a.onerror=d=>t.error(d),a.onsuccess=d=>{t.next(d.target.result),t.complete()}}).catch(n=>t.error(n))})}countByIndex(e,r,t){return new b.y(n=>{p(this.indexedDB,this.dbConfig.name,this.dbConfig.version).then(o=>{y(o,e,u=>n.error(u));const m=g(o,S(h.readonly,e,n.error)).objectStore(e).index(r).count(t);m.onerror=u=>n.error(u),m.onsuccess=u=>{n.next(u.target.result),n.complete()}}).catch(o=>n.error(o))})}deleteObjectStore(e){return function F(l,s,e){if(!l||!s||!e)throw Error('Params: "dbName", "version", "storeName" are mandatory.');return new b.y(r=>{try{const n=indexedDB.open(l,s+1);n.onupgradeneeded=o=>{const i=o.target.result;i.deleteObjectStore(e),i.close(),console.log("onupgradeneeded"),r.next(!0),r.complete()},n.onerror=o=>r.error(o)}catch(t){r.error(t)}})}(this.dbConfig.name,++this.dbConfig.version,e)}}return l.\u0275fac=function(e){return new(e||l)(c.\u0275\u0275inject(E),c.\u0275\u0275inject(c.PLATFORM_ID))},l.\u0275prov=c.\u0275\u0275defineInjectable({token:l,factory:l.\u0275fac}),l})(),z=(()=>{class l{static forRoot(e){return{ngModule:l,providers:[q,{provide:E,useValue:e}]}}}return l.\u0275fac=function(e){return new(e||l)},l.\u0275mod=c.\u0275\u0275defineNgModule({type:l}),l.\u0275inj=c.\u0275\u0275defineInjector({imports:[[I.ez]]}),l})();var B=x(4006);class j{constructor(s){this.dbService=s,this.title="playground"}add(){this.dbService.add("people",{name:"charles number "+10*Math.random(),email:"email number "+10*Math.random()}).subscribe(s=>{console.log("result: ",s)})}bulkAdd(){this.dbService.bulkAdd("people",[{name:"charles number "+10*Math.random(),email:"email number "+10*Math.random()},{name:"charles number "+10*Math.random(),email:"email number "+10*Math.random()}]).subscribe(s=>{console.log("result: ",s)})}bulkGet(){for(let s=0;s<3;s++)this.bulkAdd();this.dbService.bulkGet("people",[30,34,5]).subscribe(s=>{console.log("results: ",s)})}update(){this.dbService.update("people",{id:1,email:"asd",name:"charles"}).subscribe(s=>{console.log("result: ",s)})}delete(){this.dbService.delete("people",3).subscribe(s=>{console.log("result: ",s)})}clean(){this.dbService.clear("people").subscribe(s=>{console.log("result: ",s)})}count(){this.dbService.count("people").subscribe(s=>{console.log("result: ",s)})}createStote(s){console.log("storeName",s),this.dbService.createObjectStore({store:s,storeConfig:{keyPath:"id",autoIncrement:!0},storeSchema:[{name:"name",keypath:"name",options:{unique:!1}},{name:"email",keypath:"email",options:{unique:!1}}]})}addTwoAndGetAllByIndex(){(0,P.D)([this.dbService.add("people",{name:"desmond",email:"email number "+10*Math.random()}),this.dbService.add("people",{name:"desmond",email:"email number "+10*Math.random()})]).pipe((0,G.w)(()=>this.dbService.getAllByIndex("people","name",IDBKeyRange.only("desmond")))).subscribe(s=>console.log(s))}}j.\u0275fac=function(s){return new(s||j)(c.\u0275\u0275directiveInject(q))},j.\u0275cmp=c.\u0275\u0275defineComponent({type:j,selectors:[["lib-idb-sample"]],decls:22,vars:1,consts:[[1,"container-fluid"],[3,"click"],["type","text","name","store",3,"ngModel","ngModelChange"],["store",""]],template:function(s,e){1&s&&(c.\u0275\u0275elementStart(0,"div",0)(1,"button",1),c.\u0275\u0275listener("click",function(){return e.add()}),c.\u0275\u0275text(2,"Add new entry"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(3,"button",1),c.\u0275\u0275listener("click",function(){return e.update()}),c.\u0275\u0275text(4,"Update entry"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(5,"button",1),c.\u0275\u0275listener("click",function(){return e.delete()}),c.\u0275\u0275text(6,"Delete entry"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(7,"button",1),c.\u0275\u0275listener("click",function(){return e.clean()}),c.\u0275\u0275text(8,"Clean"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(9,"button",1),c.\u0275\u0275listener("click",function(){return e.count()}),c.\u0275\u0275text(10,"Count"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(11,"button",1),c.\u0275\u0275listener("click",function(){return e.addTwoAndGetAllByIndex()}),c.\u0275\u0275text(12,"Test #209 getAllByIndex"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(13,"button",1),c.\u0275\u0275listener("click",function(){return e.bulkAdd()}),c.\u0275\u0275text(14,"bulkAdd"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(15,"button",1),c.\u0275\u0275listener("click",function(){return e.bulkGet()}),c.\u0275\u0275text(16,"bulkGet"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(17,"div")(18,"input",2,3),c.\u0275\u0275listener("ngModelChange",function(t){return e.storeName=t}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(20,"button",1),c.\u0275\u0275listener("click",function(){return e.createStote(e.storeName)}),c.\u0275\u0275text(21,"Create Store"),c.\u0275\u0275elementEnd()()()),2&s&&(c.\u0275\u0275advance(18),c.\u0275\u0275property("ngModel",e.storeName))},dependencies:[B.Fj,B.JJ,B.On]});const V=[{path:"",component:j}];class C{}C.\u0275fac=function(s){return new(s||C)},C.\u0275mod=c.\u0275\u0275defineNgModule({type:C}),C.\u0275inj=c.\u0275\u0275defineInjector({imports:[I.ez,B.u5,O.Bz.forChild(V),z.forRoot({name:"MyDb",version:1,objectStoresMeta:[{store:"people",storeConfig:{keyPath:"id",autoIncrement:!0},storeSchema:[{name:"name",keypath:"name",options:{unique:!1}},{name:"email",keypath:"email",options:{unique:!1}}]}]})]})}}]);